<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta http-equiv="Expires" content="0">
	<meta http-equiv="Pragma" content="no-cache">
	<meta http-equiv="Cache-control" content="no-cache">
	<meta http-equiv="Cache" content="no-cache">
    <title>考试安排</title>
	<link href="css/bootstrap.css" rel="stylesheet">
    <link href="css/style.css" rel="stylesheet">
    <link rel="icon" href="images/favicon.ico">
	<!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
        <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>

<style type="text/css">
    span{ white-space:pre-wrap;word-wrap : break-word ;text-align:left;}
</style>

<body class="exam_bg">

   <!-- 隐藏滚动条 -->
   <div class="hide-scroll">

         <!-- 主体页面 -->
        <div class="exam_enterance">

            <!-- 头部标题 -->
            <div class="exam_header">
                <span class="exam_header_title" id="testName"></span>
            </div>

            <!-- 考试信息表格 -->
            <div class="exam_info">
                <table width="100%" cellpadding="0" cellspacing="0" border="0" class="table table-bordered table-hover exam_table" id="right_table">
                </table>
            </div>

            <!-- 考试须知 -->
            <div class="exam_notes">
                <span>考试须知</span>
                <br>
                <span id="exam_notes" style="text-align:left;"></span>
            </div>
        </div>
   </div>
    
    <!-- 按钮盒子 -->
    <div class="exam_start_box">
        <button class="btn exam_start_btn_disabled" disabled onclick="beginTest();">参加考试<span class="badge">5</span></button>
       <!--<button class="btn exam_start_btn_disabled" disabled onclick="sendWait();">发送待办<span class="badge">5</span></button>-->
    </div>



   <!-- 按钮区结束 -->
   <!-- 页面获取参数 -->
   <script type="text/javascript" src="/common/js/getrequest.js"></script>
   <!-- 获取cookie的js -->
   <script src="/product/workflow/js/common/getCook.js"></script>
   <script type="text/javascript" src="/common/js/config.js"></script>
   <!-- <script type="text/javascript" src="/common/js/main.js"></script> -->
   <!-- 初始化表格js -->
   <script src="/static/core/jquery/jquery-1.11.2.min.js"></script>
   <script src="/static/core/jquery-serializejson/jquery.serializejson.js"></script>
   <script src="/static/core/bootstrap/js/bootstrap.min.js"></script>
   <script src="/static/core/bootstrap-table/bootstrap-table.js"></script>
   <script src="/static/core/laydate/laydate.js"></script>
   <script src="/static/core/bootstrap-table/bootstrap-table.min.js"></script>
   <script src="/static/core/bootstrap-table/locale/bootstrap-table-zh-CN.min.js"></script>
   <script src="/static/core/layer/layer.js"></script>
   <script src="/static/js/common/mylayer.js"></script>
   <script src="/static/js/common/tablelist.js"></script>
   <script src="/static/js/common/pageEcho.js"></script>
   <script type="text/javascript" src="/static/js/common/autoCheckForm.js"></script>
   <script type="text/javascript" src="/message/js/notityMessage.js"></script>
   <!--行内编辑所需js-->
   <script src="/static/core/bootstrap-table/extensions/editable/bootstrap-table-editable.js"></script>
   <script src="/static/core/bootstrap3-editable/js/bootstrap-editable.js"></script>
   <script type="text/javascript" src="/static/core/lhgdialog/lhgcore.lhgdialog.min.js?self=true&skin=iblack"></script>
   <script src="/static/js/common/mylayer.js"></script>
   <script src="/static/js/common/tablelist.js"></script>
   <!--文件上传js-->
   <script type="text/javascript" src="/static/js/common/assistUtil.js"></script>
   <script src="/static/core/jquery-fileupload/js/vendor/jquery.ui.widget.js"></script>
   <script src="/static/core/jquery-fileupload/js/jquery.iframe-transport.js"></script>
   <script src="/static/core/jquery-fileupload/js/jquery.fileupload.js"></script>
   <script src="/static/js/common/myfilupload.js"></script>
   <!--文件上传js end-->
   <!--回显js-->
   <script src="/static/js/common/editFormEcho.js"></script>
   <script src="js/exam.config.js"></script>
   <script src="js/app.js"></script>

<script type="text/javascript">

    // 获取值班表的id
    var theRequest = GetRequest();
    var testId = theRequest.id ? theRequest.id : "";//TestId
    var workItemId1 = theRequest.workItemId1 ? theRequest.workItemId1 : "";//待办id
    if("" == workItemId1){
        workItemId1 = theRequest.workItemId ? theRequest.workItemId : "";//待办id(更多)
    }
    var isShowAnswer = "";
    var answerTime = "";
    //定义bootatrap-table数据列
    //    sortable：开启列排序，其他参考API
    var right_table_col = [
        [
            {
                "title": "考试安排",
                "halign":"center",
                "align":"center",
                "colspan": 9
            }
        ],
        [{
        field: 'id'
        , title: '序号'
        , width: '5%'
        , order: "desc"
        , align:"center"
        , formatter: function (value, row, index) {
            //计算序号，并存放开关ID，及已办事项ID
            var pageSize=$('#right_table').bootstrapTable('getOptions').pageSize;//通过表的#id 可以得到每页多少条
            var pageNumber=$('#right_table').bootstrapTable('getOptions').pageNumber;//通过表的#id 可以得到当前第几页
            var orderNum = pageSize * (pageNumber - 1) + index + 1;//计算序号
            return "<span data-id='"+row.id+"' >"+orderNum+"</span>";    //返回每条的序号： 每页条数 * （当前页 - 1 ）+ 序号
        }
    }, {
        field: 'kssj'
        , title: '考试时间'
        , width: '20%'
        , sortable: true
        , align:"center"
        , formatter:function (value, row, index) {
            return "<span data-content="+row.kssj+">"+row.startTime+" - "+row.endTime+"</span>";
        }
    }, {
        field: 'answerTime'
        , title: '答题时长(分钟)'
        , width: '15%'
        , sortable: true
        , align:"center"
    }, {
        field: 'fullScore'
        , title: '满分'
        , width: '8%'
        , sortable: true
        , align:"center"
    },{
        field: 'passScore'
        , title: '及格分'
        , width: '8%'
        , align:"center"
        ,formatter: function (value, row, index){
            if(""==value){
                return "-";
            }else{
                return value;
            }
        }
    },{
        field: 'type'
        , title: '试题类型'
        , width: '10%'
        , align:"center"
        ,formatter:function(value,row,index){
            if(value==="fzks"){
                return "法制法规";
            }else if(value==="zzllks"){
                return "政治理论";
            }else if(value==="bmks"){
                return "保密";
            }else if(value==="deptks"){
                return "部门考试";
            }
        }
    },{
        field: 'difficultyLevel'
        , title: '难易程度'
        , width: '8%'
        , align:"center"
        ,formatter:function(value, row, index){
            if(value=="1"){//1：简单；2：一般；3：困难
                return "简单";
            }else if(value=="2"){
                return "一般";
            }else if(value=="3"){
                return "困难";
            }else{
                return "-";
            }
        }
    },{
        field: 'ykcs'
        , title: '已考次数'
        , width: '8%'
        , align:"center"
    },{
        field: 'wkcs'
        , title: '剩余次数'
        , width: '8%'
        , align:"center"
    }
    ]
    ];

    $(document).ready(function (e) {
        //初始化表格
        TableInit.init({
            domId:"right_table",
            striped:false,//斑马线
            url:"/zhbg/xxkh/testmanage/getTsetInfoId",
            classes: 'table',
            pagination:false,	//不分页
            columns:right_table_col,
            queryParams:function(params){
                //这里将各个查询项添加到要传递的参数中
//                可以做一些校验
                params.id = testId;
                return params;
            },
            readOnlyFn: function (data) {
                try{
                    //回填考试名称
                    $("#testName").text(data.rows[0].name);

                    var exam_notes = "";
                    if("" == data.rows[0].testNotice){
                        exam_notes = "<p style=\"font-size: 68px; color: #E6E6E6; text-align: center;padding-top: 50px;\">暂无须知信息</p>";
                    }else{
                        exam_notes = "<p>"+data.rows[0].testNotice+"</p>";
                    }
                    //回填考试须知
                    $("#exam_notes").append(exam_notes);
                    isShowAnswer = data.rows[0].isShowAnswer;//考试完成后是否显示答案
                    answerTime = data.rows[0].answerTime;//答题时长

                }catch (e) {}
            },
            rowStyle: function (row, index) {	//默认样式：居中，鼠标为手

                return {
                    classes: 'readOnly'
                    ,css: {"text-align":"center"}
                };
            }
        });
    });

    //得到试卷id后进去考试页面
    function getPaperId(paperId,userId) {
        $.ajax({
            url:"/zhbg/xxkh/testmanage/updateBeginTestTime",
            data:{"paperId":paperId,"testId":testId,"userId":userId},
            dataType:"json",
            success:function(result){
                if(result.flag=="1"){
                    window.location.replace("/modules/zhbg/xxkh/test/beginTest.html?id="+paperId+"&testId="+testId+"&isShowAnswer="+isShowAnswer+"&workItemId1="+workItemId1+"&answerTime="+answerTime);
                }else{
                    layer.msg("更新首次进入考试时间失败！",{icon:0});
                }
            }
        });
    }

    //参加考试的按钮
function beginTest(){
    var userId = getcookie("userid");
    //获取一个试卷的id
    $.ajax({
        url:"/zhbg/xxkh/testmanage/getTestOfFristPaperId",
        data:{"id":testId,"userId":userId},
        dataType:"json",
        success:function(result){
            if(result.data.rows.length == 0){
                layer.msg('考试机会已用尽！',{icon:0});
            }else{
                getPaperId(result.data.rows[0].paperId,userId);
            }

        }
    });
	//MyLayer.layerOpenUrl({url:"/modules/zhbg/xxkh/test/beginTest.html?id="+paperId+"&testId="+testId+"&isShowAnswer="+isShowAnswer+"&workItemId1="+workItemId1+"&answerTime="+answerTime,title:'考试答题',width:'90%',height:'98%'});
}

    //参加考试的按钮
    function sendWait(){
        //获取一个试卷的id
        $.ajax({
            url:"/zhbg/xxkh/testmanage/queryAllTestUser?rdm="+Math.random(),
            dataType:"json",
            success:function(result){
                    layer.msg('发送待办成功！',{icon:0});
            }
        });
        //MyLayer.layerOpenUrl({url:"/modules/zhbg/xxkh/test/beginTest.html?id="+paperId+"&testId="+testId+"&isShowAnswer="+isShowAnswer+"&workItemId1="+workItemId1+"&answerTime="+answerTime,title:'考试答题',width:'90%',height:'98%'});
    }

</script>
</body>
</html>