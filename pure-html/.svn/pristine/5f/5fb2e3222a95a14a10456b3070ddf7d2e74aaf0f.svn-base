<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<link rel="stylesheet" type="text/css" href="/static/core/bootstrap/css/bootstrap.css">

<meta http-equiv="Expires" content="0">
<meta http-equiv="Pragma" content="no-cache">
<meta http-equiv="Cache-control" content="no-cache">
<meta http-equiv="Cache" content="no-cache">

<title></title>
</head>
<body>
	<div class="container">
		<div class="row">
			<div class="col-md-12">
				<form style="margin-top: 10px">
					<input name="id" id="id" type="hidden" value="" />
					<div class="form-group" id="affixlist"></div>
				</form>
			</div>
		</div>
	</div>

</body>
<!-- 页面获取参数 -->
<script type="text/javascript" src="/common/js/getrequest.js"></script>
<script src="/static/core/jquery/jquery-1.11.2.min.js"></script>
<script src="/static/core/layer/layer.js"></script>
<script src="/static/js/common/mylayer.js"></script>
<script src="/static/core/layui/layui.all.js"></script>
<script type="text/javascript">

$(function(){
	var theRequest = GetRequest();
	$("#id").val(regVlaue(theRequest.id));
	getAffixList("sys_notice_back",$("#id").val());
})

/**
 * 展示附件列表
 */
function getAffixList(tableName,tableId){
	$.ajax({
        type:"get",
        url:"/system/component/affix/list",
        data:{
        	"tableName":tableName,
        	"tableId":tableId
        },
        dataType:"json",
        success:function(data){
          if(data.flag == "1"){
           	 if(data.data.files){
           		 var affixList = data.data.files;
           		 if (affixList && affixList.length > 0) {
           			 for (var i = 0; i < affixList.length; i++) {
           				 $("#affixlist").append("<div class='col-md-12'><i title='下载' style='cursor:pointer;' class='glyphicon glyphicon-download-alt' onclick='downloadAffix(\""+affixList[i].id+"\")'></i>&nbsp;&nbsp;&nbsp;<a id='"+affixList[i].id+"' title='下载' href='/system/component/affix/download?affixId="+affixList[i].id+"'>"+affixList[i].name+"</a></div>");
           			 }
           		 }else{
           			layer.msg('暂无可下载的附件！')
           		 }
           	 }
            }
        },
        error:function(){
        	layer.msg("加载数据异常！请刷新重试！",{icon:2});
        }
    })
}

/**
 * 空值设置
 * @param val
 * @returns
 */
function regVlaue(val){
	if(!val){
		val = "";
	}
	return val;
}

/**
 * 
 */
function downloadAffix(id){
	window.location.href = "/system/component/affix/download?affixId="+id
}
</script>
</html>