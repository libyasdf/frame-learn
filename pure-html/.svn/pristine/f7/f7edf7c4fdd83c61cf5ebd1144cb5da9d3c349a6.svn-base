<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <meta http-equiv="Expires" content="0">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Cache-control" content="no-cache">
    <meta http-equiv="Cache" content="no-cache">

    <title></title>
    <link rel="stylesheet" type="text/css" href="/static/css/common/Loading.css">
    <link rel="stylesheet" href="/static/core/bootstrap/css/bootstrap.min.css" />
    <link rel="stylesheet" href="/static/core/bootstrapvalidator/dist/css/bootstrapValidator.min.css" />
    <link href="/static/css/common/style.css" rel="stylesheet" />
    <link href="/static/css/common/form-public.css" rel="stylesheet" />
    <!-- CSS to style the file input field as button and adjust the Bootstrap progress bars -->
    <link rel="stylesheet" href="/static/core/jquery-fileupload/css/jquery.fileupload.css">
    <link rel="stylesheet" href="/static/font/iconfont.css">
	<style type="text/css">
	#table_list tr {
	 	text-align:center
	}
	</style>
</head>

<body class="formpage_bj">
    <form class="form-horizontal" id="form">
        <!-- resId -->
        <input name="resId" id="resId" type="hidden" value="">
        <!-- 流程字段-->
        <input name="id" id="id" type="hidden" value="" /><!-- 工作项ID -->
        <input name="ideaName" id="ideaName" type="hidden" value="" /><!-- 当前用户意见域名称-->
        <input name="subflag" id="subflag" type="hidden" value="" /><!-- 流程状态 -->
        <input name="filetypeid" id="filetypeid" type="hidden" value="" /><!-- 流程ID -->
        <input name="workFlowId" id="workflowid" type="hidden" value="" /><!-- 流程唯一ID -->
        <input name="workitemid" id="workitemid" type="hidden" value="" /><!-- 待办工作项ID -->
        <input name="opertation" id="opertation" type="hidden" value="" /><!-- 操作方法 -->
        <input type="hidden" id="deptId" name="deptId" value="" /><!-- 部门id隐藏域 -->
        <input type="hidden" id="fillmode" name="fillmode" value="2">
        <input type="hidden" id="meetingRoomInfo" name="meetingRoomInfo" value="" />
        <!-- 流程字段结束 -->
        <div class="container-fluid formpage_idea">
            <div class="gw_form_block">
                <div class="gw_form_block_title">流程信息</div>
                <div class="gw_form_block_main">
                    <table width="90%" border="0" cellspacing="0" cellpadding="0" class="gw_form_block_table">
                        <tbody>
                            <tr>
                                <td width="15%" class="text-right">节点操作提示：</td>
                                <td width="85%" id="flowMemo"></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="gw_form_block">
                <div class="gw_form_block_title" onclick="showTable('yjxxTable','showOrHideImg');">
                    意见信息
                    <img align="right" style="margin-top: 10px" src="/static/images/icon7_down.gif" hspace="0" id="showOrHideImg" />
                </div>
                <div class="gw_form_block_main" id="yjxxTable">
                    <div class="table_body-wrapper">
                        <table class="table table-hover table-reset js-disk-row" style="border: 0px">
                            <tbody>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
        <div class="container-fluid formpage_area" style="margin-bottom: 140px">
            <!-- 基本信息 -->
            <div class="row">
                <div class="col-md-12 ">
                    <div class="block_title">
                        <span class="name">基本信息</span>
                    </div>
                </div>
            </div>
            <div class="row m-t-15">
                <div class="col-md-12">
                    <div class="form-group">
                        <div class="rowGroup">
                            <label for="" class="col-md-2 control-label"><b style="color: red;">*</b> 会议标题：</label>
                            <div class="col-md-10">
                                <input type="text" class="form-control" id="applyTitle" name="applyTitle">
                            </div>
                        </div>
                    </div>
                   	
                   	 <div class="form-group">
                        <div class="rowGroup">
                            <label for="" class="col-md-2 control-label"><b style="color: red;">*&nbsp;</b>主办单位：</label>
                            <div class="col-md-4" style="width: 30%;">
                                <div class="input-group" >
                                    <input type="text" id="hostDeptName" name="hostDeptName" unselectable="on" onclick="openSelectZtree({'id':'hostDeptId','name':'hostDeptName','isMulti':'1','type':'2','check':'','cancle':'','asyn':true,'level':'3','url':'/system/component/tree/deptTree','select':true})"
                                        class="form-control">
                                    <input type="hidden" id="hostDeptId" name="hostDeptId" /><!-- 人员ID隐藏域 -->
                                    <span class="input-group-addon" onclick="openSelectZtree({'id':'hostDeptId','name':'hostDeptName','isMulti':'1','type':'2','asyn':true,'level':'3','check':'',cancle:'','url':'/system/component/tree/deptTree','select':true})">
                                        <span class="glyphicon glyphicon-user"></span>
                                    </span>
                                </div>
                            </div>
                        </div>
                        <div class="rowGroup">
                            <label for="" class="col-md-2 control-label" style="width: 16%; padding-right: 0px;"><b style="color: red;">*&nbsp;</b>召集人：</label>
                            <div class="col-md-4" style="width: 36.9%;">
                                <input type="text" class="form-control" id="convenor" name="convenor">
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                    	<div class="rowGroup">
                            <label for="" class="col-md-2 control-label"><b style="color: red;">*</b> 会议类型：</label>
                            <div class="col-md-4" style="width: 30%;">
                                <select class="form-control" name="meetingType" id="meetingType"></select>
                            </div>
                        </div>
                        <div class="rowGroup">
                            <label for="" class="col-md-2 control-label" style="width: 16%; padding-right: 0px;"><b style="color: red;">*</b> 会议的起止时间：</label>
                            <div class="col-md-4" style="width: 36.9%;">
                                <input type="text" class="form-control" id="meetingTime" name="meetingTime">
                            </div>
                        </div>
                        
                    </div>
                   
                    <div class="form-group">
                        <label for="" class="col-md-2 control-label">会务服务： </label>
                        <div class="col-md-10" id="meetingServices">
                        </div>
                    </div>

                    <div class="form-group">
                        <div class="rowGroup">
                            <label for="" class="col-md-2 control-label">备注：</label>
                            <div class="col-md-10">
                                <textarea name="remark" id="remark" class="form-control" rows="3"></textarea>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- 基本信息结束 -->
            <!-- 第一个附件 -->
            <div class="form-group">
                <label for="" class="col-md-2 control-label">附件：</label>
                <div class="col-md-10">
                    <!--文件上传-->
                    <span class="btn btn-primary fileinput-button">
                        <i class="glyphicon glyphicon-plus"></i>
                        <span>选择文件...</span>
                        <input id="fileupload" type="file" name="files[]" multiple>
                    </span>
                    <div class="files row">
                        <div id="files" class="col-md-10">
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="row">
				<div class="col-md-12 ">
					<div class="block_title">
						<span id="choseRoom" class="name">会议室选择</span>
					</div>
				</div>
			</div>
			
			<div class="modal-body selectjs">
			<div class="selectjs_block" style="height: auto;">
				<div class="title_tab">
					<!-- <button class="list_table_btn22" >
                    	<span class="glyphicon glyphicon-plus-sign"></span> 选择会议室1
                	</button> -->
                	 <button class="list_table_btn2" type="button" id='meetingroomName'>
                       <span class="glyphicon glyphicon-plus-sign"></span> 选择会议室
                   </button>
				</div>
				<div class="main" style="height: auto;">
					<!--tab的主体部分-->
					<!-- 人工组卷展示内容 -->
					<div id="formpage1" class="active">
						<!--<div class="container-fluid formpage_area">-->
						

						<div class="row m-t-15">
							<div class="col-md-12">
								<table class="table table-bordered" name="table">
									<thead>
										<tr id="tr">
											<th width="10%" class="text-center">序号</th>
											<th width="10%" class="text-center">预定日期</th>
											<th width="20%" class="text-center">星期</th>
											<th width="20%" class="text-center">会议室名称</th>
											<th width="20%" class="text-center">预定时间段</th>
											<th width="20%" class="text-center">操作</th>
										</tr>
									</thead>
									<tbody id="table_list">
									</tbody>
								</table>
							</div>
						</div>
					</div>
					
				
				</div>
				
			</div>
		</div>
            
        </div>
    </form>
    

    <!--意见信息start-->
    <div class="container-fluid gw_form_bottom_yijian" id="ideaArea" style="display: none;margin-bottom: 50px;">
        <table width="100%" border="0" cellspacing="0" cellpadding="0" class="gw_form_bottom_table  mt_10">
            <tr>
                <td width="15%" class="title">我的意见：</td>
                <td width="85%">
                    <table>
                        <tr>
                            <td rowspan="2" width="90%">
                                <textarea name="textarea" id="idea" cols="45" rows="3" placeholder="意见最多填写200字" class="form_textarea"
                                    style="width: 100%;" onkeyup="this.value = this.value.substring(0,200)"></textarea>
                                <span id="idea-count" value="">0</span>/200
                                </textarea>
                            </td>
                            <td width="10%"><select class="btn btn-default" name="CuOpinion" id="CuOpinion" onchange="onSelect(this.value,'idea')"></select></td>
                        </tr>
                        <tr>
                            <td>
                                <a class="white" href="#" onclick="add('idea')">+添加常用意见</a></td>
                        </tr>
                    </table>
                </td>
            </tr>
        </table>
    </div>
    <!--意见信息end-->
    <div class="gw_form_right_btn_area" style=" right: 20px; top: 20px; position: fixed;">
        <ul>
            <li><a href="#" onclick="openLayer('1')"><span class="glyphicon glyphicon-list-alt" aria-hidden="true"></span>
                    流程记录</a></li>
            <li><a href="#" onclick="openLayer('2')"><span class="glyphicon glyphicon-random" aria-hidden="true"></span>
                    流程图</a></li>
            <li><a href="#" onclick="openLayer('3')"><span class="glyphicon glyphicon-pencil" aria-hidden="true"></span>
                    意见信息</a></li>
        </ul>
    </div>
    <div class="form_btn_area" style="text-align: center;">
        <button id="save" class="btn btn-primary form_btn_area_btn2" style="display: none" onclick="commitForm();"><span class="glyphicon glyphicon-floppy-disk"
                aria-hidden="true"></span> 保存</button>
        <button id="subflow" class="btn btn-primary form_btn_area_btn2" style="display: none" onclick="commitFlow();"><span class="glyphicon glyphicon-send" aria-hidden="true"></span> 发送</button>
        <button id="approval" class="btn btn-primary form_btn_area_btn2" style="display: none" onclick="completeFlow('',Config.approvalflag)"><span
                class="glyphicon glyphicon-ok" aria-hidden="true"></span> 通过</button>
        <button id="noApproval" class="btn btn-primary form_btn_area_btn2" style="display: none" onclick="completeFlow('',Config.noApprovalflag);"><span
                class="glyphicon glyphicon-remove" aria-hidden="true"></span> 不通过</button>
        <button id="remove" class="btn btn-primary form_btn_area_btn2" style="display: none" onclick="removeFlow()"><span
                class="glyphicon glyphicon-ban-circle" aria-hidden="true"></span> 撤办</button>
        <button id="resumeFlow" class="btn btn-primary form_btn_area_btn2" style="display: none" onclick="resumeFlow()"><span
                class="glyphicon glyphicon-repeat" aria-hidden="true"></span> 重新启用</button>
        <button id="takeBack" class="btn btn-primary form_btn_area_btn2" style="display: none" onclick="takeBack()"><span
                class="glyphicon glyphicon-repeat" aria-hidden="true"></span> 收回重用</button>
    </div>
    <!-- 按钮区结束 -->
    <script src="/static/core/jquery/jquery-1.11.2.min.js"></script>
    <script src="/static/core/bootstrap/js/bootstrap.min.js"></script>
    <script src="/static/core/bootstrap-table/bootstrap-table.min.js"></script>
    <script src="/static/core/bootstrap-table/locale/bootstrap-table-zh-CN.min.js"></script>
    <script src="/static/core/bootstrapvalidator/dist/js/bootstrapValidator.min.js"></script>
    <script src="/static/core/layer/layer.js"></script>
    <script src="/static/js/common/mylayer.js"></script>
    <script type="text/javascript" src="/static/js/common/assistUtil.js"></script>

    <script src="/static/core/laydate/laydate.js"></script>
    <!-- 流程相关 -->
    <script type="text/javascript" src="/modules/system/component/tree/js/deptUserTree.js"></script>
    <script type="text/javascript" src="/common/js/config.js"></script>
    <script type="text/javascript" src="/product/workflow/js/storages.js"></script>
    <script type="text/javascript" src="/common/js/commonFunction.js"></script>
    <!-- 获取cookie值 -->
    <script type="text/javascript" src="/product/workflow/js/common/getCook.js"></script>
    <!-- 页面获取参数 -->
    <script type="text/javascript" src="/common/js/getrequest.js"></script>
    <!-- 引入自己模块功能的js -->
    <script type="text/javascript" src="/modules/zhbg/hygl/meetingApply/js/meetingApplyForm.js"></script>
    <!-- 自定义意见(最后进行加载) -->
    <script type="text/javascript" src="/common/html/notion/notion.js"></script>
    <!-- 数据校验 -->
    <script type="text/javascript" src="/modules/zhbg/hygl/meetingApply/js/meetingApplyValidator.js"></script>
    <!-- 数据回显 -->
    <script type="text/javascript" src="/static/js/common/displayData.js"></script>
    <!--点击折叠展开-->
    <script type="text/javascript" src="/static/js/common/toggle.js"></script>
    <!--文件上传js-->
    <script src="/static/core/jquery-fileupload/js/vendor/jquery.ui.widget.js"></script>
    <script src="/static/core/jquery-fileupload/js/jquery.iframe-transport.js"></script>
    <script src="/static/core/jquery-fileupload/js/jquery.fileupload.js"></script>
    <script src="/static/js/common/myfilupload.js"></script>
    <!--文件上传js end-->
    <script type="text/javascript">
        var iframeWin;         // 子窗口
        var ParentSelectList = [];  // 回显数据对象
        var sendChildData = [];  // 往子页面发送的数据
    var curDate = getCurrentDate("yyyy-MM-dd")
    var curDate1;
    var minDate = getBeforeDate(curDate,-1);

    var flag="0";//开始日期和结束日期不相等
   laydate.render({
    	  elem: '#meetingTime'
    	  ,type: 'datetime'
    	  ,min: curDate
    	  ,range: true
    	  ,done: function(value, date, endDate){
          	$('#meetingTime').val(value).change()
          }
   		  ,ready:function(date){
   			  console.info($("#meetingTime").val())
   			  console.info($("#meetingTime").val().substring(0,10))
   			  console.info($("#meetingTime").val().substring(23,10))
   		  }
    	});

   // 禁用分钟和秒选项

        var dataList;
        scrollTop.init();
        $(function () {
            // 初始化参数
            var theRequest = GetRequest();
            $("#resId").val(theRequest.resId ? theRequest.resId : "");
            if (theRequest.resId) {
                $("#resId").val(theRequest.resId);
            } else {
                $("#resId").remove();
            }
            if ($("#id").val() == "") {
                $("#deptId").val(getcookie("deptid"));
            }
        });

        $("#meetingroomName").click(function () {
        	
        	if($("#meetingTime").val()==""){
        		layer.msg("请先先选择会议的起止时间再选择会议室！", {
    				icon : 0
    			});
        		return;
        	}
            var meetingroomId = $('#meetingroomId').val();
            var meetingStartDate = $('#meetingStartDate').val();
            var meetingStartTime = $('#meetingStartTime').val();
            var meetingEndDate = $('#meetingEndDate').val();
            var meetingEndTime = $('#meetingEndTime').val();
            MyLayer.layerOpenUrl({
                url: '/modules/zhbg/hygl/meetingApply/choseMeetingRoom.html?meetingroomId=' + meetingroomId + "&meetingStartDate=" + meetingStartDate + "&meetingStartTime=" + meetingStartTime + "&meetingEndDate=" + meetingEndDate + "&meetingEndTime=" + meetingEndTime,
                title: "选择会议室",
                success:function(layero,index){
                    var body = layer.getChildFrame('body',index);//建立父子联系
                    iframeWin = window[layero.find('iframe')[0]['name']];
                    var trs = $('#table_list tr');
                    var subflag = $('#subflag').val();
                    iframeWin.getParentData(trs,subflag);
                },
                cancel:function () {
                    console.log('查看父级数据')
                    console.log(ParentSelectList)
                }
            })

        })
        //  数据回显 获取数据 (在子页面调用该方法)
        function getChildData(data){
            console.log(' 父页面数据回显 获取数据 (在子页面调用该方法)')
            ParentSelectList = data;
            var dom = $('#table_list');
            iframeWin.appendDom(dom,ParentSelectList);
            // 绑定删除方法
            dom.find('.delect').off('click');
            dom.find('.delect').on('click',function () {
                var delId = $(this).attr('id');
                $(this).parents('tr').remove();
                // $.post("/zhbg/hygl/meetingRoomUseInfo/deletById", { id: delId },
                //     function(data){
                //         if(data.flag=="1"){
                //             $(tr).remove();
                //         }
                //     }
                // );
            })
            console.log(ParentSelectList)
        }

        var selectDate;//日期控件中被选中的日期值
        var hourCnt;//当前时间的小时值
        var dayCnt;//当前时间的天值
        function getBeforeDate(date, n) {
            var n = n;
            var d = new Date(date);
            var year = d.getFullYear();
            var mon = d.getMonth() + 1;
            var day = d.getDate();
            if (day <= n) {
                if (mon > 1) {
                    mon = mon - 1;
                } else {
                    year = year - 1;
                    mon = 12;
                }
            }
            d.setDate(d.getDate() - n);
            year = d.getFullYear();
            mon = d.getMonth() + 1;
            day = d.getDate();
            s = year + "-" + (mon < 10 ? ('0' + mon) : mon) + "-" + (day < 10 ? ('0' + day) : day);
            return s;
        }


        /**
         * 初始化数据结构
         */
        var result={};
        function initDataStru(){
            //  写入日期数据
            // 当前显示时间
            var endTime = $("#meetingTime").val().substring(22,32);
            var showDate = $("#meetingTime").val().substring(0,10);
            var week = '';
            SelectedList = [];

            week = getWeekDay(showDate)
            var selectedObj = {
                date:showDate,
                week:week,
                data:[
                ]
            }
            SelectedList.push(selectedObj);

            while (showDate<endTime){
                console.log(showDate,endTime)
                showDate = getBeforeDate(showDate,-1);
                week = getWeekDay(showDate)
                selectedObj = {
                    date:showDate,
                    week:week,
                    data:[]
                }
                SelectedList.push(selectedObj);
            }
            console.log('初始化数据结构')
            console.log(SelectedList)
            return SelectedList;
        }

    </script>
</body>

</html>