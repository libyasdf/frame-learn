<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="Expires" content="0">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Cache-control" content="no-cache">
    <meta http-equiv="Cache" content="no-cache">
    <title>表单页面</title>
    <link rel="stylesheet" href="/static/core/bootstrap/css/bootstrap.min.css"/>
    <link rel="stylesheet" href="/static/core/bootstrapvalidator/dist/css/bootstrapValidator.min.css"/>
    <link rel="stylesheet" type="text/css" href="/static/font/iconfont.css">
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="/static/core/html5/html5shiv.min.js"></script>
    <script src="/static/core/html5/respond.js"></script>
    <![endif]-->
    <link href="/static/css/common/style.css" rel="stylesheet"/>
    <link href="/static/css/common/form-public.css" rel="stylesheet"/>
    <link href="/static/core/bootstrap-table/bootstrap-table.css" rel="stylesheet"/>
<style type="text/css">
    	span#hh{ white-space:pre-wrap;word-wrap : break-word ;overflow: hidden ;text-align:left}
</style> 

</head>

<body class="formpage_bj">
<div class="container-fluid formpage_area" style="min-height: 300px">
    <form class="form-horizontal" id="form">
    	<input type="hidden" id="id"/>
        <!-- 基本信息 -->
        <div class="row">
            <div class="col-md-12 ">
                <div class="block_title">
                    <span class="name">考试基本信息</span>
                </div>
            </div>
        </div>
        <div class="row m-t-15">
            <div class="col-md-12">
                <div class="form-group">
                    <label for="" class="col-md-2 control-label">考试名称：</label>
                    <div class="col-md-4 form-view">
                        <span name="name" id="hh"></span>
                    </div>
                </div>
                <div class="form-group">
                	<label for="" class="col-md-2 control-label">考试时间：</label>
                    <div class="col-md-4 form-view">
                        <span name="timeRange"></span>
                    </div>
                    <label for="" class="col-md-2 control-label">难易程度：</label>
                    <div class="col-md-4 form-view">
                        <span name="difficultyLevel"></span>
                    </div>
                </div>
                <div class="form-group">
                    <label for="" class="col-md-2 control-label">答题时长(分钟)：</label>
                    <div class="col-md-4 form-view">
                        <span name="answerTime"></span>
                    </div>
                   	<label for="" class="col-md-2 control-label"> 考试后显示成绩：</label>
	                  <div class="col-md-4 form-view">
	                     <span name="isShowAnswer"></span>
	                  </div>
                </div>
                <div class="form-group">
                    <label for="" class="col-md-2 control-label">考试须知：</label>
                    <div class="col-md-7 form-view">
                        <span name="testNotice" id="hh"></span>
                    </div>
                </div>
                <!-- 考试试卷信息 -->
                <div class="row">
		            <div class="col-md-12 ">
		                <div class="block_title">
		                    <span class="name">考试试卷</span>
		                </div>
		            </div>
        		</div>
        		<div class="form-group">
                	<label for="" class="col-md-2 control-label">试卷名称：</label>
                    <div class="col-md-4 form-view" id="files"></div>
                    <label for="" class="col-md-2 control-label"> 是否多次考试：</label>
                    <div class="col-md-4 form-view">
                        <span name="isMoreChance"></span>
                    </div>
                </div>
        		<div class="form-group">
                	 <label for="" class="col-md-2 control-label">考试分数：</label>
                    <div class="col-md-4 form-view">
                        <span name="fullScore"></span>
                    </div>
                	<label for="" class="col-md-2 control-label">及格分数：</label>
                    <div class="col-md-4 form-view">
                        <span name="passScore"></span>
                    </div>
                </div>
                <!-- 考试人员信息 -->
                <div id="one">
                    <div class="row">
                        <div class="col-md-12 ">
                            <div class="block_title">
                                <span class="name">考试人员</span>
                            </div>
                        </div>
                    </div>
                    <p></p>
                    <div class="form-group">
	                	<label for="" class="col-md-2 control-label">上报考试人员：</label>
	                    <div class="col-md-4 form-view">
	                        <span name="testToDepartment"></span>
	                    </div>
               		 </div>
                    <div class="row m-t-15" style="margin-top: 15px;">
                        <div class="col-md-12 p-f-60">
                        	<table id="right_table"></table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </form>
</div>

<!-- 按钮区 -->
<div class="form_btn_area" style="text-align: center;">
    <button id="preserveBtn" class="btn btn-primary form_btn_area_btn2" onclick="MyLayer.closeOpen();" ><span class="glyphicon glyphicon-remove-circle" aria-hidden="true"></span> 关闭</button>
</div>
<!-- 按钮区结束 -->

<script src="/static/core/jquery/jquery-1.11.2.min.js"></script>
<script src="/static/core/bootstrap/js/bootstrap.min.js"></script>
<script src="/static/core/bootstrap-table/bootstrap-table.min.js"></script>
<script src="/static/core/bootstrap-table/locale/bootstrap-table-zh-CN.min.js"></script>
<script src="/static/core/layer/layer.js"></script>
<script src="/static/js/common/mylayer.js"></script>
<script src="/static/js/common/pageEcho.js"></script>
<!-- 页面获取参数 -->
<script type="text/javascript" src="/common/js/getrequest.js"></script>
<!-- 试卷回显js -->
<script src="/modules/zhbg/xxkh/testManage/js/testpaperupload.js"></script>
<!-- 表格js -->
<script src="/static/js/common/tablelist.js"></script>
<script type="text/javascript">
	var isReport = false;
	var right_table_col = [{
	    //field: 'id'
	    field: ''
	    , title: '序号'
	    , width: '8%'
	    , sortable: false
	    , align:"center"
	    , formatter: function (value, row, index) {
	        //计算序号，并存放开关ID，及已办事项ID
	       /*  var pageSize=$('#right_table').bootstrapTable('getOptions').pageSize;//通过表的#id 可以得到每页多少条
	        var pageNumber=$('#right_table').bootstrapTable('getOptions').pageNumber;//通过表的#id 可以得到当前第几页
	        var orderNum = pageSize * (pageNumber - 1) + index + 1;//计算序号 */
	        return "<span data-id='"+row.id+"' >"+(index+1)+"</span>";    //返回每条的序号： 每页条数 * （当前页 - 1 ）+ 序号
	    } 
	},{
	    //field: 'candidateJuName'
	    field: 'candidateJuName'
		    , title: '部门'
		    , width: '15%'
		    , sortable: false
		    , align:"center"
		    ,formatter:function(value,row,index){
				return "<span dept-id='"+row.candidateJuId+"' >"+row.candidateJuName+"</span>";
			}
	},{
	    field: 'candidateChushiName'
	    , title: '处室'
	    , width: '15%'
	    , sortable: false
	    , align:"center"
	    ,formatter:function(value,row,index){
			return "<span dept-id='"+row.candidateChushiId+"' >"+row.candidateChushiName+"</span>";
		}
	},{
	    field: 'num'
	    , title: '人数'
	    , sortable: false
	    , width: '10%'
	    , align:"center"
	},{
	    field: 'cz'
	    , title: '操作'
	    , sortable: false
	    , width: '10%'
	    , align:"center"
		,formatter:function(value,row,index){
			var html = '';
			if(isReport){
				html += '<a onclick="openTestPerson(\''+row.candidateChushiId+'\');"><i title="查看人员详情" style="cursor:pointer" class="glyphicon glyphicon-search"></i></a>';
				html += '&nbsp;&nbsp;<a href="" ><i title="催报" class="iconfont icon-phone"></i></a>';
			}else{
				html += '<a onclick="openTestPerson(\''+row.candidateChushiId+'\');"><i title="查看人员详情" style="cursor:pointer" class="glyphicon glyphicon-search"></i></a>';
			}
			return html;
		}
	}]; 
    $(document).ready(function () {
    	var theRequest = GetRequest();
    	//获取考试id
    	var id = theRequest.id;
    	$("#id").val(theRequest.id);
    	var resId = theRequest.resId;
        // 加载数据
        var params = {
        		id:id,
        		resId:resId
        };
        //考试信息回显
        $.getJSON("/zhbg/xxkh/testmanage/edit",params, function (result) {
            var data = result.data;
            /** 是否上报考试人员 */
        	if(data.testToDepartment=="1"){
        		data.testToDepartment = "是";
        	}else{
        		data.testToDepartment = "否";
        	}
        	/** 考试难易程度 1：简单；2：一般；3：困难 */
        	if(data.difficultyLevel=="1"){
        		data.difficultyLevel = "简单";
        	}else if(data.difficultyLevel=="2"){
        		data.difficultyLevel = "一般";
        	}else{
        		data.difficultyLevel = "困难";
        	}
        	/** 考试是否显示答案 */
        	if(data.isShowAnswer=="1"){
        		data.isShowAnswer = "是";
        	}else{
        		data.isShowAnswer = "否";
        	}
        	/** 是否多次考试 */
        	if(data.isMoreChance=="1"){
        		data.isMoreChance = "是";
        	}else{
        		data.isMoreChance = "否";
        	}
        	data.timeRange = data.startTime+" 至 "+data.endTime;
            PageEcho.parseData({
                data: data,
            });
        });
      	//试卷列表回显
		MyPaperUpload.init({
			fileListId:"files",
			viewUrl:"/zhbg/xxkh/testmanage/getPapers",
			viewParams:{testId:id},
			editOrView:"VIEW"
		});
		//初始化表格
		$.ajax({
		url:"/zhbg/xxkh/testmanage/getTestPersonCountInUserPaper?testId="+$("#id").val()+"&resId="+$("#resId").val()+"&rdm="+Math.random(),
		async:false,
		success:function(json){
			if (json.flag == '1') {
				$('#right_table').bootstrapTable({
			        sidePagination:"client",
			        pagination:true,
			        striped:false,
			        classes: 'table table-hover',
			        fixedColumns: true,//是否固定列
			        fixedNumber: "", //固定列数
			        pageList: "[10, 25, 50, 100]",
			        columns: right_table_col,
			        responseHandler:function(res){
						return responseHandler(res);
					},
			        rowStyle: function (row, index) {	//默认样式：居中，
			        	
			            return {
			                classes: 'readOnly'
			                ,css: {"text-align":"center","cursor":"default"}
			            };
			        },
			        onLoadSuccess: function () {
			        }
				});
				$('#right_table').bootstrapTable('load',json.data); 
			}else {
				
			}
		}
	});  
        /* TableInit.init({
            domId:"right_table",
            url:"/zhbg/xxkh/testmanage/getTestPersonCountInUserPaper",
            columns:right_table_col,
            queryParams:function(params){
               	params.resId = resId;
            	params.testId = id;
                return params;
            },
			rowStyle: function (row, index) {	//默认样式：居中，鼠标为手
                return {
                    classes: 'readOnly'
                    ,css: {"text-align":"center","cursor":"default"}
                };
            }
        }); */
      	/* //考试人员列表初始化
        TableInit.init({
            domId:"right_table",
            url:"/zhbg/xxkh/testmanage/getTestPersonCountInUserPaper",
            columns:right_table_col,
            queryParams:function(params){
            	params.resId = resId;
            	params.testId = id;
                return params;
            },
            rowStyle: function (row, index) {	//默认样式：居中，
                return {
                    classes: 'readOnly'
                    ,css: {"text-align":"center","cursor":"default"}
                };
            }
        }); */
    })
     //打开查看考试人员详情
    function openTestPerson(chushiId){
    	var theRequest = GetRequest();
    	var resId = theRequest.resId;
    	MyLayer.layerOpenUrl({
    		url:'/modules/zhbg/xxkh/testManage/ksglPerson.html?chushiId='+chushiId+'&testId='+$("#id").val()+"&resId="+resId,
 			title:'人员详情',
 			width:'90%',
 			height:'90%'
		});
    }
</script>
</body>
</html>
 