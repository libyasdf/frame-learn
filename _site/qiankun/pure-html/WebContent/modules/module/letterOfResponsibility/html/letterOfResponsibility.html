


    <link rel="stylesheet" href="/static/core/zTree_v3/css/zTreeStyle/zTreeStyle.css" type="text/css">
    <link rel="stylesheet" href="/static/core/layui/css/layui.css">
    <!--下js|css已经被引用过了,在主页面-->
    <!--
    <link rel="stylesheet" type="text/css" href="/static/core/bootstrap/css/bootstrap.css">
    <script src="/static/core/jquery/jquery-1.11.2.min.js"></script>
    <script src="/static/core/bootstrap/js/bootstrap.min.js"></script>
    <script src="/manage/layui/dist/layui.js"></script>-->

    <!--让IE8/9支持媒体查询，兼容栅格布局-->
    <script src="/static/core/html5/html5shiv.min.js"></script>
    <script src="/static/core/html5/respond.js"></script>
    <!--树状图-->
    <script src="/static/core/zTree_v3/js/jquery.ztree.all.min.js"></script>


	<style>
        /*自定义树图标*/
        .ztree li span.button.diyicon_ico_open{
            /*若此不设置会用自动的图片,所以需要加点样式*/
            margin-right: 2px;
            background-position: -110px -16px;
            background-position-x: -110px;
            background-position-y: -16px;
            vertical-align: top;
        }
        .ztree li span.button.diyicon_ico_close{
            /*若此不设置会用自动的图片,所以需要加点样式*/
            margin-right: 2px;
            background-position: -110px 0;
            vertical-align: top;
        }
        .ztree li span.button.diyicon_ico_docu{
            background: url(/static/images/user.png)
        }

        .lor_left{
            border-right: 1px dashed #00000054;
            padding-right: 0px;
        }
        #lor_tree_dep{
            width: calc(100% - 6px);
            display: inline-block;
        }
        .rol_in_right{
            width: 4px;
            background: white;
            float: right;
            cursor:move;
            margin-right: 1px;
        }
        .rol_cursor_move{
            cursor:move;
        }
	</style>




    <div class="lor_left_right col-md-12" style="padding: 0px;">
        <div class="col-md-2 lor_left" >
            <ul id="lor_tree_dep" class="ztree"></ul>
            <div class="rol_in_right">&nbsp;</div>
        </div>
        <div  class="lor_right col-md-10">
            <div class="panel panel-default">
                <div class="panel-heading">
                    <div class="col-md-7" style="margin-top: 15px">
                        <h3 id="dep_ex_name">XXX局</h3>
                    </div>
                    <div class="pull-right" style="margin-top: 18px;">
                        <span>签订年份:</span><input style="width: 272px;display: inline-block;" type="text" class="layui-input" id="lor_time">
                    </div>
                    <div class="col-md-12" style="margin-bottom: 12px">
                        <button class="btn btn-primary" type="button">
                            总人数 <span class="badge" id="lor_headcount">42</span>
                        </button>
                        <button class="btn btn-primary" type="button">
                            已签人数 <span class="badge" id="lor_signed">30</span>
                        </button>
                        <button class="btn btn-primary" type="button">
                            未签人数 <span class="badge" id="lor_notsign">12</span>
                        </button>
                        <div class="pull-right" style="margin-top: 8px;">
                            <span class="label label-success" style="font-size: 13px;">已签状态</span>
                            <span class="label label-info" style="font-size: 13px;">未签状态</span>
                        </div>
                    </div>
                </div>
                <table class="table table-bordered" id="lor_table">
                    <tbody>
                        <tr>
                            <th class="info">Thornton</th>
                            <td class="success">Thornton</td>
                            <td class="info">Thornton</td>
                            <td class="success">@Thornton</td>
                        </tr>
                        <tr>
                            <th class="success">Thornton</th>
                            <td class="info">Larry</td>
                            <td class="success">the Bird</td>
                            <td class="success">Larry</td>
                        </tr>
                        <tr>
                            <th class="success">Thornton</th>
                            <td class="info">Larry</td>
                            <td class="success">the Bird</td>
                            <td class="success">Larry</td>
                        </tr>
                        <tr>
                            <th class="success">Thornton</th>
                            <td class="info">Larry</td>
                            <td class="success">the Bird</td>
                            <td class="success">Larry</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>





<script>
    (function(){
        //下变量方便切换年时重新加载数据
        var lor_dep_id_now='441';//当前部门id
        var levelBoolean=false;
        var lor_date_now=new Date().getYear()+1900;


        //日期初始化
        laydate.render({
            elem: '#lor_time',
            type: 'year',
            value: lor_date_now,
            done: function(value, date, endDate){
                if(value&&value!=lor_date_now){
                    lor_date_now=value;
                    if(levelBoolean){
                        departmentsCrew(lor_dep_id_now,lor_date_now);
                    }else{
                        subDepartments(lor_dep_id_now,lor_date_now);
                    }
                }
            }
        });
        function initTree() {//初始化树
            $.ajax({
                'url' :'/system/component/tree/deptTree',
                'type':'get',
                'dataType':'json',
                'data' : {
                    'deptId':441,
                    'level':2
                },
                'success' : function(data){
                    var setting = {
                        view: {
                            selectedMulti: false
                        },
                        data:{
                            simpleData: {
                                enable: true,
                                idKey: "uuid",//代表本身的标识
                                pIdKey:"uupid"//其父的标识
                            }
                        },
                        callback:{
                            onClick:onclick_tree
                        }
                    }
                    var nodes =data;
                    if (nodes.length > 0) {//默认第一层打开
                        nodes[0].open = true;
                    }
                    $(nodes).each(function(index,item){
                        item.iconSkin="diyicon";
                    });
                    var zTreeObj = $.fn.zTree.init($("#lor_tree_dep"), setting, nodes);
                },
                'complete':function(){

                }
            });
        }
        initTree();        
        //点击树的回调函数
        function onclick_tree(event, treeId, treeNode) {
            //debugger;
            //console.log(treeNode.uuid);
            var dep_tree_id=treeNode.tId;//部门在树的id
            levelBoolean=$("#"+dep_tree_id).hasClass("level2");//被点击节点是否是处级
            lor_date_now=$('#lor_time').val();
            if(!lor_date_now){
                layer.msg("请选择日期!", {icon: 0});
                return false;
            }
            lor_dep_id_now=treeNode.uuid;//当前部门id记录一下,方便切换年时重新加载数据
            if(levelBoolean){
                departmentsCrew(lor_dep_id_now,lor_date_now);
            }else{
                subDepartments(lor_dep_id_now,lor_date_now);
            }
            //生成右侧部门关系族谱开始
            var dep_ex_name= $("#"+dep_tree_id).children("a").attr("title");
            for (var intt = 0; intt<1;){
                var par_title=$("#"+dep_tree_id).parent().parent("li").children("a").attr("title");
                dep_tree_id=$("#"+dep_tree_id).parent().parent("li").attr("id");
                if(!par_title){
                    intt=1;
                }else{
                    dep_ex_name=par_title+" / "+dep_ex_name;
                }
            }
            $("#dep_ex_name").text(dep_ex_name);
            //生成右侧部门关系族谱结束
        }
        //根据部门id生成其子部门的详细信息
        function subDepartments(depid,selectTime) {
            $.ajax({
                'url' :'letterResponsibilityController/subDepartments',
                'type':'POST',
                'dataType':'json',
                'data' : {
                    'depid':depid,
                    'time':selectTime
                },
                'success' : function(data){
                    if(!data){data=[];}
                    if(data.statusCode&&data.statusCode!=200){
                        layer.msg("data.valueDescribe", {icon: 0});
                        return;
                    }else{
                        if(data.valueDescribe){
                            data=data.valueDescribe;
                        }

                        $("#lor_headcount").text(data.headcount);
                        $("#lor_signed").text(data.signed);
                        $("#lor_notsign").text(data.notsign);
                        //生成空表格
                        var datalength=data.subDepartments.length;//数据部门个数

                        var tbodyHtml="<thead>\n" +
                                            "<tr>\n" +
                                                "<th class='col-md-1'>#</th>\n" +
                                                "<th class='col-md-5'>部门名称</th>\n" +
                                                "<th class='col-md-2'>总人数</th>\n" +
                                                "<th class='col-md-2'>已签人数</th>\n" +
                                                "<th class='col-md-2'>未签人数</th>\n" +
                                            "</tr>\n" +
                                        "</thead>";
                        tbodyHtml+="<tbody>";
                        $(data.subDepartments).each(function(index,item){
                            tbodyHtml+="<tr>";
                            tbodyHtml+="<th>"+index+"</th>";
                            tbodyHtml+="<td>"+item.name+"</td>";
                            tbodyHtml+="<td>"+item.headcount+"</td>";
                            tbodyHtml+="<td>"+item.signed+"</td>";
                            tbodyHtml+="<td>"+item.notsign+"</td>";
                            tbodyHtml+="</tr>";
                        });
                        tbodyHtml+="</tbody>";//结束
                        $("#lor_table").html(tbodyHtml).addClass("table-striped").removeClass("table-condensed");
                        $(data.departmentsCrew).each(function(index,item){
                            var name=item.name;
                            var type=item.type;
                            if(type==0){
                                type="info";
                            }else{
                                type="success";
                            }
                            $("#lor_table td:eq("+index+")").addClass(type).text(name);
                        });
                    }



                },
                'complete':function(){

                }
            });
        }
        //根据部门id生成人员的详细信息
        function departmentsCrew(depid,selectTime) {
            $.ajax({
                'url' :'letterResponsibilityController/departmentsCrew',
                'type':'POST',
                'dataType':'json',
                'data' : {
                    'depid':depid,
                    'time':selectTime
                },
                'success' : function(data){
                    if(!data){data=[];}
                    if(data.statusCode&&data.statusCode!=200){
                        layer.msg("data.valueDescribe", {icon: 0});
                        return;
                    }else{
                        if(data.valueDescribe){
                            data=data.valueDescribe;
                        }
                        $("#lor_headcount").text(data.headcount);
                        $("#lor_signed").text(data.signed);
                        $("#lor_notsign").text(data.notsign);
                        //生成空表格
                        var datalength=data.departmentsCrew.length;//数据人名个数
                        var colnum=12;//列个数
                        var rownum=Math.ceil(datalength/colnum);//行个数
                        var tbodyHtml="<tbody>";
                        for (var i = 0; i < rownum; i++){
                            tbodyHtml+="<tr>";
                            for (var ii = 0; ii < colnum; ii++){
                                tbodyHtml+="<td></td>";
                            }
                            tbodyHtml+="</tr>";
                        }
                        tbodyHtml+="</tbody>";//结束
                        $("#lor_table").html(tbodyHtml).addClass("table-condensed").removeClass("table-striped");
                        $(data.departmentsCrew).each(function(index,item){
                            var name=item.name;
                            var type=item.type;
                            if(type==0){
                                type="info";
                            }else{
                                type="success";
                            }
                            $("#lor_table td:eq("+index+")").addClass(type).text(name);
                        });
                    }

                },
                'complete':function(){

                }
            });
        }

    })();
</script>

<script>
    (function(){
        var rol_mouse_up=false;//是否开启实时调整宽
        var rol_now_windth;//当前宽度
        var rol_now_pageX;//当前鼠标X位置
        $(".rol_in_right").mousedown(function (e) {//移到此div(才会有鼠标样式),此时按下触发
            //console.log("按下触发!");
            rol_now_windth= parseFloat($(".lor_left").css("width"));//当前宽度
            //console.log("宽度A为:"+$(".lor_left").width());
            //console.log("宽度B为:"+$(".lor_left").css("width"));
            rol_now_pageX=e.pageX;
            rol_mouse_up=true;
            $(".lor_left_right").addClass("rol_cursor_move");//给移动范围div(即鼠标在此范围移到才调整宽度)加鼠标样式
        })
        $(".lor_left_right").on("mouseup mouseleave",function () {
            //console.log("松开或移出触发!");
            $(".lor_left_right").removeClass("rol_cursor_move");//给移动范围div,减鼠标样式
            if(rol_mouse_up){
                rol_mouse_up=false;
            }
        })
        $(".lor_left_right").mousemove(function(e){//鼠标移动时触发
            e.preventDefault();
            if(rol_mouse_up){
                var widthDifference=e.pageX-rol_now_pageX;//获取鼠标所在坐标
                rol_now_pageX=e.pageX;
                rol_now_windth+=widthDifference;
                if(rol_now_windth<100){
                    rol_now_windth=100;
                }
                var rol_now_right_windth=parseFloat($(".lor_left_right").css("width"))-rol_now_windth;
                if(rol_now_right_windth<600){
                    rol_now_right_windth=600;
                    rol_now_windth=parseFloat($(".lor_left_right").css("width"))-rol_now_right_windth;
                }
                $(".lor_left").css("width",rol_now_windth+"px");
                $(".lor_right").css("width",rol_now_right_windth+"px");
                //$(".lor_right").width(rol_now_windth);

            }
        });
    })();
</script>
