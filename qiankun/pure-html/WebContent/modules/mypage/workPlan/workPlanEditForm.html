<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <meta http-equiv="Expires" content="0">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Cache-control" content="no-cache">
    <meta http-equiv="Cache" content="no-cache">
    
    <title>企业中心</title>
    <link rel="stylesheet" href="/static/core/bootstrap/css/bootstrap.min.css"/>
    <link rel="stylesheet" href="/static/core/bootstrapvalidator/dist/css/bootstrapValidator.min.css"/>
    <link href="/static/css/common/style.css" rel="stylesheet"/>
    <link href="/static/css/common/form-public.css" rel="stylesheet"/>
    <link rel="stylesheet" href="/static/core/jquery-fileupload/css/jquery.fileupload.css">
     <link rel="stylesheet" type="text/css" href="/static/font/iconfont.css">
     <!-- Bootstrap -->
    <link href="/static/core/bootstrap-table/bootstrap-table.css" rel="stylesheet"/>
   	<link rel="stylesheet" type="text/css"
	href="/static/core/bootstrap-table/extensions/reorder-rows/bootstrap-table-reorder-rows.css">
<style type="text/css">
body {
	box-sizing: border-box;
	overflow-y: hidden;
}

.main {
	width: 100%;
	height: 100%;
	font-size: 0;
	box-sizing: border-box;
}

.left {
	padding-left:10px;
	display: inline-block;
	box-sizing: border-box;
	width: 50%;
	height: 720px;
	font-size: 14px;
	overflow-y:hidden;
	/* overflow-y:scroll; */
	overflow-x:hidden;
	padding-right:20px;
	border-right:5px solid #eee; 
}

.right {
	padding-left:10px;
	display: inline-block;
	width: 50%;
	height: 720px;
	font-size: 14px;
	box-sizing: border-box;
	overflow-x:hidden;
	overflow-y:hidden;
	padding-right:10px;
}

iframe {
	width: 100%;
	height: 100%;
	border: 2px solid #eee;
	border-bottom: 0px;
	box-sizing: border-box;
}

.panel-controls {
	position: absolute;
	right: 40px;
	top: 10px;
}

.panel-controls>i.showSelect {
	font-size: 16px;
	color: #acb1b8;
	cursor: pointer;
}
#right_table ,#right_table2  {
	font-size: 14px;
}
.c1{
	margin-left:18px;
}
.block_title1{
	height: 40px;
	line-height: 40px;
	position: relative;
}
.c2{
	margin-left:-30px;
}
.read{
	cursor: auto;
    background-color: #fff;
    opacity: 1;
}
#count{
            text-align:center;
            word-wrap:break-word;
            word-break:break-all;
            white-space:normal;
}
</style>
</head>

<body>
     <span id="tishi" style="text-align: center;display:block;color: red;"></span>
     	<!-- 隐藏域 -->
        <input name="resId" id="resId" type="hidden" value="">
		
		
      <div class="main"  >
       
        <!-- 左边计划信息开始 -->
		<div class="left left-js">
			<div class="row">
				<div class="col-md-12 ">
					<div class="block_title">
						<span class="name">添加计划</span>
					</div>
				</div>
			</div>
    		<form class="form-horizontal" id="form">
		   		<div class="row m-t-15">
            		<div class="col-md-12">
             			<div class="form-group">
                    		<div class="col-md-4">
                    		<input name="id" id="id1"  type="hidden" value=""/>
                         	<input type="hidden" name="datePlan" class="form-control" id="datePlan" readonly="readonly" placeholder=""> 
                        	<input type="hidden" name="flag" id="flag">
                    		</div>
                		</div>
	                	 <div class="form-group">
		                    <label for="" class="col-md-2 control-label"> <b style="color: red;">*</b> 类别：</label>
		                    <div class="col-md-3">
		                        <select  id="planType" name="planType"  class="form-control" ></select>
		                    </div>
		                    <div id = "remindDiv" style="display: none">
		                     <label for="" class="col-md-3 control-label c2"> 提醒时间:</label>
			                    <div class="col-md-4">
			                        <input type="text"  id="remindTime" name="remindTime"  class="form-control" readonly="readonly" style="cursor: auto;background-color: #fff;">
			                        <input type="hidden" name="isFinish" id="isFinish" value="0"/>
			                        <input type="hidden" name="isChange" id="isChange" value="0"/>
			                    </div>
			                  <!-- <label for="" class="col-md-2 control-label c2"> 提醒时间
			                  <span class="glyphicon glyphicon-exclamation-sign userTitle" data-toggle="tooltip" data-placement="bottom" title="显示的时间为整点！"></span>
			                  :</label>
			                    <div class="col-md-2">
			                        <input type="text"  id="remindTime1" name="remindTime1"  class="form-control" >
			                    </div> -->  
		                    </div>
	                	</div>
	                 	<div class="form-group">
		                 <label for="" class="col-md-2 control-label"><b style="color: red;">*</b> 内容：</label>
		                    <div class="col-md-10">
		                    <textarea name="content" autofocus="autofocus" id="content" class="form-control" rows="3" ></textarea>
		                    </div>
	               		</div>
            		</div>
        		</div>
    		</form>
    	
    		<!-- 按钮区 -->
			<div style="text-align: center;">
				<button id="save" class="btn btn-primary form_btn_area_btn2"
					onclick="save();">
					<span class="glyphicon glyphicon-floppy-disk" aria-hidden="true"></span>
					保存
				</button>
			</div> 
		
			<!-- 列表区 -->
			<div class="row">
	            <div class="col-md-12 ">
					<div class="block_title1">
						<!-- <span class="name">计划列表</span> -->
					</div>
				</div>
        	</div>
			<div class="col-md-12 c1" unselectable="on" onselectstart="return false;" style="-moz-user-select:none;">
				<!--bootstrap-table表格-->
				<table id="right_table" data-use-row-attr-func="true" data-reorderable-rows="true"></table>
			</div>
		</div>
		<!-- 左边计划区域结束 -->
		
		<!-- 右边日志区域开始 -->
		<div class="right right-js">
        	<div class="row">
            	 <div class="col-md-12 ">
					<div class="block_title">
						<span class="name">添加日志</span>
					</div>
				</div>
        	</div>
	           <!-- 工作项ID -->
			<form class="form-horizontal" id="form2">
	        	<div class="row m-t-15">
		            <div class="col-md-12">
		            	<div class="form-group">
                    		<div class="col-md-4">
                    		 <input name="id" id="id2"  type="hidden" value=""/>
                    		<input type="hidden" name="datePlan1" class="form-control" id="datePlan1" readonly="readonly" placeholder=""> 
                        	<input type="hidden" name="flag1" id="flag1">
                    		</div>
                		</div>
		             	<div class="form-group">
		             	
		                    <label for="" class="col-md-2 control-label"> <b style="color: red;">*</b> 类别：</label>
		                    <div class="col-md-3">
		                        <select  id="planType2" name="planType2"  class="form-control"  ></select>
		                        <input type="hidden" id="type2" name="planType"  />
		                        <input type="hidden" name="isFinish"  value="1"/>
		                    </div>
	                	</div>
		                 <div class="form-group">
		                 	<label for="" class="col-md-2 control-label"><b style="color: red;">*</b> 内容：</label>
		                    <div class="col-md-10">
		                    <textarea name="content" autofocus="autofocus" id="content2" class="form-control" rows="3" ></textarea>
		                    </div>
	               		</div>
		            </div>
        		</div>
    		</form>
    		
    		<!-- 保存按钮区 -->
   		 	<div style="text-align: center;">
				<button id="save" class="btn btn-primary form_btn_area_btn2"
				onclick="save2();">
					<span class="glyphicon glyphicon-floppy-disk" aria-hidden="true"></span>
				保存
				</button>
			</div>     
				
			<!-- 日志列表区 -->
			<div class="row">
	            <div class="col-md-12 ">
	                <div class="block_title1">
	                     <!-- <span class="name">日志列表</span>  -->
	                </div>
	            </div>
        	</div>
 			<div class="col-md-12 c1"  unselectable="on" onselectstart="return false;" style="-moz-user-select:none;">
				<!--bootstrap-table表格-->
				<table id="right_table2" data-use-row-attr-func="true" data-reorderable-rows="true"></table>
			</div>
			
		</div>
		<!-- 右边日志区域结束 -->
            
      </div>   
          
<script type="text/javascript" src="/static/js/common/assistUtil.js"></script>
<script src="/static/core/jquery/jquery-1.11.2.min.js"></script>
<script src="/static/core/bootstrap/js/bootstrap.min.js"></script>
<script src="/static/core/bootstrap-table/bootstrap-table.min.js"></script>
<script src="/static/core/bootstrap-table/locale/bootstrap-table-zh-CN.min.js"></script>
<script src="/static/core/bootstrapvalidator/dist/js/bootstrapValidator.min.js"></script>
<script src="/static/core/layer/layer.js"></script>
<script src="/static/js/common/mylayer.js"></script>
<script type="text/javascript" src="/static/js/common/assistUtil.js"></script>
<script src="/static/js/common/tablelist.js"></script>
<script src="/static/core/laydate/laydate.js"></script>
<!-- 流程相关 -->
<script type="text/javascript" src="/common/js/config.js"></script>
<script type="text/javascript" src="/product/workflow/js/storages.js"></script>
<script type="text/javascript" src="/common/js/commonFunction.js"></script>
<!-- <script type="text/javascript" src="/common/js/overlay.js"></script> -->
<!-- 获取cookie值 -->
<script type="text/javascript" src="/product/workflow/js/common/getCook.js"></script>
<!-- 页面获取参数 -->
<script type="text/javascript" src="/common/js/getrequest.js"></script>
<!-- 自定义意见(最后进行加载) -->
<script type="text/javascript" src="/common/html/notion/notion.js"></script>
<!-- 数据回显 -->
<script type="text/javascript" src="/static/js/common/displayData.js"></script>

<!--文件上传js-->
<!-- The jQuery UI widget factory, can be omitted if jQuery UI is already included -->
<script src="/static/core/jquery-fileupload/js/vendor/jquery.ui.widget.js"></script>
<!-- The Iframe Transport is required for browsers without support for XHR file uploads -->
<script src="/static/core/jquery-fileupload/js/jquery.iframe-transport.js"></script>
<!-- The basic File Upload plugin -->
<script src="/static/core/jquery-fileupload/js/jquery.fileupload.js"></script>
<script src="/static/js/common/myfilupload.js"></script>
<!-- 引入自己模块功能的js -->
<script type="text/javascript" src="js/workPlanEdit.js"></script>
<!-- <script type="text/javascript" src="js/workPlanValidator.js"></script> -->
<!--文件上传js end-->
<script type="text/javascript">
Dictionary.init({mark:'log_type',type:'1',position:"planType",domType:"select",name:"planType",hasSelect:false});
Dictionary.init({mark:'log_type',type:'1',position:"planType2",domType:"select",name:"planType2",hasSelect:false});
    scrollTop.init();

</script>
<!--文件上传js end-->
<script type="text/javascript">
//Dictionary.init({mark:'log_type',type:'1',position:"planType",domType:"select",name:"planType"});
var curDate = getCurrentDate("yyyy-MM-dd HH:mm:ss")
//alert($("#datePlan").val())

$(function () {
	if($("#datePlan").val()>curDate){
		$('#remindDiv').css("display", "block")
	}
    // 禁用分钟和秒选项
	function disableTimeSelection(){
	    // console.log('禁用分钟和秒')
        $('.laydate-time-list').children('li').each(function(index,itemList){
            if(index<=0) {
                $(this).children('ol').children('li').removeClass('laydate-disabled')
            }
            if(index>0){
               $(this).children('ol').children('li').addClass('laydate-disabled')
            }
        })
	}
    var now = $("#datePlan").val()+" 23:00:00";
    var minDate = getBeforeDate(curDate,-1);
	laydate.render({
        elem: '#remindTime' //指定元素
        ,btns: ['clear', 'confirm']
        ,type: 'datetime'
        ,min: minDate
        ,max: now
        ,ready:function(date){
            // disableTimeSelection();   // 禁用分钟和秒选项
			// 绑定切换面板事件
			selectDate = date.date;
            $('.laydate-btns-time').click(function(){
            	var len = $('.laydate-time-list li:first ol li:lt('+hourCnt+')').length;
            	/* if(selectDate==dayCnt){
	            	$('.laydate-time-list li:first ol li').each(function(index){
	            		if(index<=hourCnt){
	            			//alert(index)
	            			$(this).addClass('laydate-disabled')
	            			
	            		}s
	    			})
            	} */
    			
                // 禁用分钟和秒选项
                $('.laydate-time-list').children('li').each(function(index,itemList){
                    if(index<=0) {
                        //$(this).children('ol').children('li').removeClass('laydate-disabled')
					}
					if(index>0){
						 $(this).children('ol').children('li').addClass('laydate-disabled')
                    }
                    // 绑定选择小时的点击事件
                    $('.laydate-time-list').find('li').click(function(){
                        disableTimeSelection();   // 禁用分钟和秒选项
                        if(selectDate!=dayCnt) return;
                        $('.laydate-time-list li:first ol li').each(function(index){
    	            		if(index<=hourCnt){
    	            			//alert(index)
    	            			$(this).addClass('laydate-disabled')
    	            			
    	            		}
    	    			})
                    })
                })
            });

	    }
	    ,change:function(value, date, endDate){
           // disableTimeSelection();   // 禁用分钟和秒选项
           console.log(value)
           console.log(date)
           console.log(endDate)
	    	selectDate = parseInt(date.date);
           console.log(endDate)
		}
        ,done: function(value, date, endDate){
        	$('#remindTime').val(value).change()
        	
        }
		
    });

	laydate.render({ 
		elem: '#remindTime1'
		,type: 'time'
		,btns:['clear', 'confirm']
		,format:'HH点'   // 时间显示格式
		,ready:function(date){
            disableTimeSelection();   // 禁用分钟和秒选项
        }
        ,change:function(value, date, endDate){
            disableTimeSelection();   // 禁用分钟和秒选项
		}
	});
	if($("#datePlan").val()){
		loadData($("#datePlan").val());
	}



})
var selectDate;//日期控件中被选中的日期值
var hourCnt;//当前时间的小时值
var dayCnt;//当前时间的天值
 function getBeforeDate(date,n) {
	        var n = n;
	        var d = new Date(date.replace(/-/g, '/'));
	        var year = d.getFullYear();
	        var mon = d.getMonth() + 1;
	        var day = d.getDate();
	        var hours = d.getHours();
	        hourCnt=parseInt(hours)
	        dayCnt = parseInt(day)
	        if(day <= n) {
	            if(mon > 1) {
	                mon = mon - 1;
	            } else {
	                year = year - 1;
	                mon = 12;
	            }
	        }
	        d.setDate(d.getDate() - n);
	        year = d.getFullYear();
	        mon = d.getMonth() + 1;
	        day = d.getDate()-1;
	        s = year + "-" + (mon < 10 ? ('0' + mon) : mon) + "-" + (day < 10 ? ('0' + day) : day)+" " + (hours+1) + ":00:00";
	        return s;
	    }
    //绑定日期输入input
    /*  laydate.render({
        elem: '#datePlan' //指定元素
        ,trigger: 'click'
    	,done : function(value, date, endDate) {
    		$("#isFinish").val("");
			//$("#content").val("");
			//$("#content").html("");
			$("#id").val("");
    		//alert(value);
    		if(value==""){
				$("#datePlan").value("")
			}else{
				$("#datePlan").val(value).change()
				TableInit.refTable('right_table');
				TableInit.refTable('right_table2');
				loadData($("#datePlan").val());
				//$("#form").data('bootstrapValidator').destroy();
		        //$('#form').data('bootstrapValidator', null);
				//$("#form").data('bootstrapValidator').resetForm(true);
				//initFormData();
				//alert($("#content").val());
			}
    	}
    }); */
    
     var right_table_col = [{
         title: '序号'
        , width: '5%'
        , order: "desc"
        , align:"center"
        , formatter: function (value, row, index) {
        	  var pageSize=$('#right_table').bootstrapTable('getOptions').pageSize;
              var pageNumber=$('#right_table').bootstrapTable('getOptions').pageNumber;
              var orderNum = pageSize * (pageNumber - 1) + index + 1;//计算序号
              return "<span style='cursor:default' data-id='"+row.id+"'>"+orderNum+"</span>";
           }
    },/*  {
        field: 'datePlan'
        , title: '日期'
        , width: '15%'
        , align:"center"
    }, */ {
        field: 'content'
        , title: '内容'
        , width: '40%'
        , align:"center"
        , formatter: function (value, row, index) {
        	if(value!=null){
        		var length = value.length
	  	   	      var val = '';
	  	   	      if(length>30){
	  	   	    	  val = value.substring(0,25)+"...";//
	  	   	      }else{
	  	   	    	  val = value;
	  	   	      }
  	   	   		return  "<span style='cursor:default' title='"+value+"' data-content='"+row.content+"'>"+val+"</span>";
        	}else{
        		return "";
        	}
        	 
        }
    }, {
        field: 'planType'
            , title: '类别'
            , width: '10%'
            , align:"center"
            , formatter: function (value, row, index) {
                    if(value=='0'){
                    	return "<span style='cursor:default'>日常</span>"
                    }else if(value=='1'){
                    	return "<span style='cursor:default'>业务</span>"
                       
                    }else if(value=='2'){
                    	return "<span style='cursor:default'>党务</span>"
                       
                    }else {
                    	return "<span style='cursor:default'>其他</span>"
                       
                    }
                    
             }
     },
     {
        field: 'remindTime'
        , title: '提醒时间'
        , width: '15%'
        , align:"center"
        , formatter: function (value, row, index) {
               if(value == ""||value == null){
            	   return "<span style='cursor:default'>-</span>";
               }else{
                	return "<span style='cursor:default'>" + value + "</span>"
               }
               
                
         }
    }, {
        field: 'cz'
            , title: '操作'
            , width: '10%'
            , align:"center"
            , formatter: function (value, row, index) {  //直接定义function,return就是html代码
                var opt = value.split(",");
            	var content = row.content;
            	var html = "";
                    for (var i = 0; i < opt.length; i++) {
                        if (opt[i] == "add") {
                        } else if (opt[i] == "update") {
                        	html += "<i class='glyphicon glyphicon-edit' style='cursor:pointer' title='修改' onclick=\'list.editFun(\"" + row.id + "\",\"" + row.planType + "\",\""+index+"\",\"" + row.remindTime + "\",\"" + row.isChange + "\")\'></i>&nbsp;&nbsp;";
                        } else if (opt[i] == "delete") {
                        	 html += "<i class='glyphicon glyphicon-trash' style='cursor:pointer' title='删除' onclick=\'list.deleteFun(\"" + row.id + "\")\'></i>&nbsp;&nbsp;";
                        }else if (row.isChange!='1') {
                        	 html += "<i class='glyphicon glyphicon-ok-sign' style='cursor:pointer' title='转为日志' onclick=\'list.finishFun(\"" + row.id + "\")\'></i>";
                        }
                    }
                return html;
            }
        }];
     var right_table_col2 = [{
         title: '序号'
        , width: '5%'
        , order: "desc"
        , align:"center"
        , formatter: function (value, row, index) {
        	  var pageSize=$('#right_table').bootstrapTable('getOptions').pageSize;
              var pageNumber=$('#right_table').bootstrapTable('getOptions').pageNumber;
              var orderNum = pageSize * (pageNumber - 1) + index + 1;//计算序号
              return "<span style='cursor:default' data-id='"+row.id+"'>"+orderNum+"</span>";
           }
    }, /* {
        field: 'datePlan'
        , title: '日期'
        , width: '15%'
        , align:"center"
    }, */ {
        field: 'content'
        , title: '内容'
        , width: '40%'
        , align:"center"
        , formatter: function (value, row, index) {
        	if(value!=null){
        		var length = value.length
	  	   	      var val = '';
	  	   	      if(length>30){
	  	   	    	  val = value.substring(0,25)+"...";//
	  	   	      }else{
	  	   	    	  val = value;
	  	   	      }
  	   	   		return  "<span style='cursor:default' title='"+value+"' data-content='"+row.content+"'>"+val+"</span>";
        	}else{
        		return "";
        	}
        	 
        }
    }, {
        field: 'planType'
            , title: '类别'
            , width: '10%'
            , align:"center"
            , formatter: function (value, row, index) {
            	 if(value=='0'){
                 	return "<span style='cursor:default'>日常</span>"
                 }else if(value=='1'){
                 	return "<span style='cursor:default'>业务</span>"
                    
                 }else if(value=='2'){
                 	return "<span style='cursor:default'>党务</span>"
                    
                 }else {
                 	return "<span style='cursor:default'>其他</span>"
                    
                 }
                    
             }
     }/* ,
    {
        field: 'isFinish'
        , title: '状态'
        , width: '10%'
        , align:"center"
        , formatter: function (value, row, index) {
                if(value=='0')
                	return '未完成'
                else 
                    return '完成'
                
         }
    } */,{
        field: 'cz'
            , title: '操作'
            , width: '10%'
            , align:"center"
            , formatter: function (value, row, index) {  //直接定义function,return就是html代码
                var opt = value.split(",");
                var html = "";
                    for (var i = 0; i < opt.length; i++) {
                        if (opt[i] == "add") {

                        } else if (opt[i] == "update") {
                        	html += "<i class='glyphicon glyphicon-edit' style='cursor:pointer' title='修改' onclick=\'list.editFun2(\"" + row.id + "\",\"" + row.planType + "\",\"" + index + "\")\'></i>&nbsp;&nbsp;";
                        } else if (opt[i] == "delete") {
                        	 html += "<i class='glyphicon glyphicon-trash' style='cursor:pointer' title='删除' onclick=\'list.deleteFun2(\"" + row.id + "\")\'></i>";
                        }
                    }
                return html;
            }
        }];
     function loadData(datePlan){
    	 
     	$("input[type='checkbox']").attr("checked",true)
         //初始化表格
         TableInit.init({
             domId:"right_table",
             url:"/mypage/workplan/getlistBootHql",
             columns:right_table_col,
             //height:320,
             rowStyle:function (row, index) {	//默认样式：居中
                 return {
                     classes: 'readOnly'
                     ,css: {"text-align":"center"}
                 };
             },
             queryParams:function(params){
             	 params.resId = $('#left_ul').find('a.active').attr("id");
             	 var types=[];
             	 $("input[type='checkbox']:checked").each(function(){
             		 types.push(this.value)
             	 })
             	params.dateLogYear = "";
             	params.dateLogMonth ="";
             	params.dateLogWeek = "";
             	params.dateLog = $("#datePlan").val()+" - "+$("#datePlan").val();
             	params.timeCondition ='3';
             	params.isFinish = '0';
                params.content = "";
                params.planType = "0,1,2,3";
                 return params;
             },
             readOnlyFn:function(){
            	//根据表格高控制滚动条的显示和隐藏
     			controleScroll();
             }
            
         });
     	
        TableInit.init({
            domId:"right_table2",
            url:"/mypage/workplan/getlistBootHql",
            columns:right_table_col2,
            //height:320,
            rowStyle:function (row, index) {	//默认样式：居中
                return {
                    classes: 'readOnly'
                    ,css: {"text-align":"center"}
                };
            },
            queryParams:function(params){
            	 params.resId = $('#left_ul').find('a.active').attr("id");
            	 var types=[];
            	 $("input[type='checkbox']:checked").each(function(){
            		 types.push(this.value)
            	 })
            	params.dateLogYear = "";
            	params.dateLogMonth ="";
            	params.dateLogWeek = "";
            	params.dateLog = $("#datePlan").val()+" - "+$("#datePlan").val();
            	params.timeCondition ='3';
            	params.isFinish = '1';
                params.content = "";
                params.planType = "0,1,2,3";
                return params;
            },
            readOnlyFn:function(){
            	//根据表格高控制滚动条的显示和隐藏
    			controleScroll();
            }
           
        });
     }
//   表格数据项的操作
     var list = {
         editFun:function(id,planType,index,remindTime,isChange){
        	 var content = $("#right_table tbody tr[data-index='"+index+"']").find("td:eq(1)").find("span").attr("data-content");
        	 $("#isChange").val(isChange);
        	 $("#id1").val(id);
     		$("#content").val(content);
     		$("#planType").val(planType);
     		if(remindTime == undefined || remindTime == null || remindTime == ""||remindTime == 'null'){
     			$("#remindTime").val("");
     		}else{
     			$("#remindTime").val(remindTime);
     		}
     		
         	  /* var resId = $('#left_ul').find('a.active').attr("id");
             MyLayer.layerOpenUrl({
             	 url: '/modules/mypage/workPlan/workPlanLogEditForm.html?id=' + id + "&datePlan="+datePlan+"&oper=EDIT&resId=" + resId,
                 title:"修改工作计划"
             }) */
         },
         editFun2:function(id,planType,index){
        	 var content = $("#right_table2 tbody tr[data-index='"+index+"']").find("td:eq(1)").find("span").attr("data-content");
        	 $("#id2").val(id);
   			//$("#isFinish").val("");
      		$("#content2").val(content);
      		$("#planType2").val(planType);
        	  /* var resId = $('#left_ul').find('a.active').attr("id");
            MyLayer.layerOpenUrl({
            	 url: '/modules/mypage/workPlan/workPlanLogEditForm.html?id=' + id + "&datePlan="+datePlan+"&oper=EDIT&resId=" + resId,
                title:"修改工作计划"
            }) */
        },
         deleteFun:function(id){
         	 var resId = $('#left_ul').find('a.active').attr("id");
             deleteOpt({
             	url: '/mypage/workplan/delete?id=' + id+ "&resId=" + resId,
                 tableId:'right_table'
             })
           //根据表格高控制滚动条的显示和隐藏
 			controleScroll();
         },
         deleteFun2:function(id){
         	 var resId = $('#left_ul').find('a.active').attr("id");
             deleteOpt({
             	url: '/mypage/workplan/delete?id=' + id+ "&resId=" + resId,
                tableId:'right_table2'
             })
           //根据表格高控制滚动条的显示和隐藏
 			controleScroll();
         },
         finishFun:function(id){
        	 var data = "";
         	 var resId = $('#left_ul').find('a.active').attr("id");
         	layer.confirm('确认是否将该计划转为日志！',{icon:3,title:'确认'},function(){
         		 $.ajax({
                     url: '/mypage/workplan/upFinish?id=' + id+ "&resId=" + resId
                     , type: "GET"
                     , dataType: "json"
                     , success: function (result) {
                         var msg = "";
                         if (result.flag === "1") {
                        	 	$("#id2").val("");
                    			$("#id1").val("");
                     			$("#isFinish").val("");
                     			$("#remindTime").val("");
                        		$("#content2").val("");
                        		$("#content").val("");
                        		$("#planType").val("0");
                        		$("#planType2").val("0");
                             msg = '计划转为日志成功！';
                             if ($.trim(result.msg)) {
                                 msg = result.msg;
                             }
                             layer.msg(msg, {icon: 1});
                             TableInit.refTable('right_table');
                             TableInit.refTable('right_table2');
                             if(window.parent.$("#workLog_table").text()){
                            	 parent.TableInit.refTable('workLog_table');
                                 parent.TableInit.refTable('workLog_table2'); 
                             }
                             
                             if($('#year', window.parent.document).val()&&$('#month', window.parent.document).val()){
  	        					parent.setData($('#year', window.parent.document).val().substring(0,$('#year', window.parent.document).val().indexOf("年")), $('#month', window.parent.document).val().substring(0,$('#month', window.parent.document).val().indexOf("月")))
  	        				 }else if($('#year', window.top.document).val()&&$('#month', window.top.document).val()){
  	        					top.setData($('#year', window.top.document).val().substring(0,$('#year', window.top.document).val().indexOf("年")), $('#month', window.top.document).val().substring(0,$('#month', window.top.document).val().indexOf("月")))
  	        				 }
                             
                           //根据表格高控制滚动条的显示和隐藏
                 			controleScroll();
                         } else {
                             msg = '计划转为日志失败，请重试！';
                             if ($.trim(result.msg)) {
                                 msg = result.msg;
                             }
                             layer.msg(msg, {icon: 2});
                         }
                     }
                     , error: function () {
                         layer.msg('计划转为日志失败，请重试！', {icon: 2});
                     }
                 })
         		});
         }
     }
     
function  deleteOpt (json) {
         /**
          * 删除确定框的默认参数
          * @type {{url: string, msg: string, confirmBtn: confirmBtn, cancelBtn: cancelBtn}}
          */
         var delArg = {
             url: ""
             , msg: "确定要删除吗？"
             , tableId: "table"
             , confirmBtn: function (json) { //确定按钮的事件
                 //发送ajax请求来删除，传参url就是删除的地址
                 //_delArg.url
                 $.ajax({
                     url: json.url
                     , type: "GET"
                     , dataType: "json"
                     , success: function (result) {
                         var msg = "";
                         if (result.flag === "1") {
                       	  	$("#id2").val("");
                   			$("#id1").val("");
                   			$("#isFinish").val("");
                   			$("#remindTime").val("");
                       		$("#content2").val("");
                       		$("#content").val("");
                       		$("#planType").val("0");
                       		$("#planType2").val("0");
                             msg = '删除成功！';
                             if ($.trim(result.msg)) {
                                 msg = result.msg;
                             }
                             layer.msg(msg, {icon: 1});
                             TableInit.refTable(json.tableId);
                             if(typeof(json.tableIds)!="undefined"){
                             	TableInit.refTable(json.tableIds);
                             }
                             if(window.parent.$("#workLog_table").text()){
                            	 parent.TableInit.refTable('workLog_table');
                                 parent.TableInit.refTable('workLog_table2'); 
                             }
                             if($('#year', window.parent.document).val()&&$('#month', window.parent.document).val()){
 	        					parent.setData($('#year', window.parent.document).val().substring(0,$('#year', window.parent.document).val().indexOf("年")), $('#month', window.parent.document).val().substring(0,$('#month', window.parent.document).val().indexOf("月")))
 	        				}else if($('#year', window.top.document).val()&&$('#month', window.top.document).val()){
 	        					top.setData($('#year', window.top.document).val().substring(0,$('#year', window.top.document).val().indexOf("年")), $('#month', window.top.document).val().substring(0,$('#month', window.top.document).val().indexOf("月")))
 	        				}
                         } else {
                             msg = '删除失败，请重试！';
                             if ($.trim(result.msg)) {
                                 msg = result.msg;
                             }
                             layer.msg(msg, {icon: 2});
                         }
                     }
                     , error: function () {
                         layer.msg('删除失败，请重试！', {icon: 2});
                     }
                 })
                 // layer.msg('删除成功', {icon: 1, time: 1000});
                 // layer.msg('删除失败', {icon: 0,time:1000});
             }
             , cancelBtn: function () { //取消按钮的事件
                 // layer.msg('也可以这样', {
                 //     time: 20000, //20s后自动关闭
                 //     btn: ['明白了', '知道了']
                 // });
             }
         };

         var _delArg = $.extend(delArg, json);
         //询问框
         layer.confirm(_delArg.msg, {
             btn: ['确定', '取消'] //按钮
         }, function () {
             _delArg.confirmBtn(_delArg)
         }, _delArg.cancelBtn);
     };
     function save(){
  	        if($("#datePlan").val()){
  	        	if(	$("#content").val()&&$("#planType").val()){
  	        		if($("#content").val().replace(/[\u0391-\uFFE5]/g,"aa").length >100){
  	        			layer.msg("内容不能超过50个字！", {
  	    	                icon: 0
  	    	            });
  	        		}else{
  	        			saveChange0();
  	        		}
  	        	}else if (!$("#content").val()){
  	        		layer.msg("内容不能为空！", {
  	  	                icon: 0
  	  	            });
  	        	}else if (!$("#planType").val()){
  	        		layer.msg("类型不能为空！", {
  	  	                icon: 0
  	  	            });
  	        	}
  	        }else{
  	        	layer.msg("请选择一个日期！", {
  	                icon: 0
  	            });
  	        }
 }
     function save2(){
    	 $("#datePlan1").val($("#datePlan").val());
 	        if($("#datePlan").val()){
 	        	if($("#content2").val()&&$("#planType2").val()){
					if($("#content2").val().replace(/[\u0391-\uFFE5]/g,"aa").length >100){
						layer.msg("内容不能超过50个字！", {
		 	                icon: 0
		 	            });
 	        		}else{
 	        			saveChange1();
 	        		}
 	        	}else if (!$("#content2").val()){
  	        		layer.msg("内容不能为空！", {
  	  	                icon: 0
  	  	            });
  	        		return;
  	        	}else if (!$("#planType2").val()){
  	        		layer.msg("类型不能为空！", {
  	  	                icon: 0
  	  	            });
  	        	}
 	        }else{
 	        	layer.msg("请选择一个日期！", {
 	                icon: 0
 	            });
 	        }
}

     function saveChange0(){
 		var info = "";
 		$("#isFinish").val("0");
 		//var bootstrapValidator = $("#form").data('bootstrapValidator');
 	    //手动触发验证
 	    //bootstrapValidator.validate();
 	   // if(bootstrapValidator.isValid()){
 	    				$.ajax({
 	    	        		type: "POST",
 	    	        		url:"/mypage/workplan/saveForm",
 	    	        		data:$("#form").serialize(),
 	    	        		async: false,
 	    	        		success:function(json){
 	    	        			if (json) {
 	    	        				info = json.id;
 	    	        				$("#id1").val(json.id);
 	    	        				if($('#year', window.parent.document).val()&&$('#month', window.parent.document).val()){
 	    	        					parent.setData($('#year', window.parent.document).val().substring(0,$('#year', window.parent.document).val().indexOf("年")), $('#month', window.parent.document).val().substring(0,$('#month', window.parent.document).val().indexOf("月")))
 	    	        				}else if($('#year', window.top.document).val()&&$('#month', window.top.document).val()){
 	    	        					top.setData($('#year', window.top.document).val().substring(0,$('#year', window.top.document).val().indexOf("年")), $('#month', window.top.document).val().substring(0,$('#month', window.top.document).val().indexOf("月")))
 	    	        				}
 	    	        			}
 	    	        		}
 	    	        	});
 	    	
 	    //}
 	    if(info){
 			layer.msg("保存成功！", {icon: 1});
 			$("#id1").val("");
 			$("#isChange").val("0");
 			//$("#isFinish").val("");
    		$("#content").val("");
    		$("#remindTime").val("");
    		$("#content").focus();
    		$("#planType").val("0")
    		//if(window.parent.$("#right_table").text()){
 			TableInit.refTable('right_table')
    		//}
 			//刷新列表
 			if(window.parent.$("#workLog_table").text()){
 			parent.TableInit.refTable('workLog_table');
 			parent.TableInit.refTable('workLog_table2');
 			}
    		//根据表格高控制滚动条的显示和隐藏
			controleScroll();
 			
}
} 
     function saveChange1(){
    		var info = "";
    		$("#content").val($("#content2").val());
    		$("#type2").val($("#planType2").val());
    		//var bootstrapValidator = $("#form2").data('bootstrapValidator');
    	    //手动触发验证
    	   // bootstrapValidator.validate();
    	   // if(bootstrapValidator.isValid()){
    	    				$.ajax({
    	    	        		type: "POST",
    	    	        		url:"/mypage/workplan/saveForm",
    	    	        		data:$("#form2").serialize(),
    	    	        		async: false,
    	    	        		success:function(json){
    	    	        			if (json) {
    	    	        				info = json.id;
    	    	        				$("#id2").val(json.id);
    	    	        				if($('#year', window.parent.document).val()&&$('#month', window.parent.document).val()){
    	    	        					parent.setData($('#year', window.parent.document).val().substring(0,$('#year', window.parent.document).val().indexOf("年")), $('#month', window.parent.document).val().substring(0,$('#month', window.parent.document).val().indexOf("月")))
    	    	        				}else if($('#year', window.top.document).val()&&$('#month', window.top.document).val()){
    	    	        					top.setData($('#year', window.top.document).val().substring(0,$('#year', window.top.document).val().indexOf("年")), $('#month', window.top.document).val().substring(0,$('#month', window.top.document).val().indexOf("月")))
    	    	        				}
    	    	        			}
    	    	        		}
    	    	        	});
    	    	
    	   // }
    	    if(info){
    			layer.msg("保存成功！", {icon: 1});
    			$("#id2").val("");
     			//$("#isFinish").val("");
        		$("#content2").val("");
        		$("#content2").focus();
        		$("#content").val("");
        		$("#planType").val("0");
        		$("#planType2").val("0");
        		//if(window.parent.$("#right_table2").text()){
    			TableInit.refTable('right_table2');
        		//}
    			//刷新列表
    			if(window.parent.$("#workLog_table").text()){
    			parent.TableInit.refTable('workLog_table');
    			parent.TableInit.refTable('workLog_table2');
    			}
    			//根据表格高控制滚动条的显示和隐藏
    			controleScroll();
    			
    	}  		
    	}
     function dateChange(date){
    	 
     }
     
     function controleScroll(){
    	//根据表格高控制滚动条的显示和隐藏
    	var num = $('#right_table').bootstrapTable('getOptions').pageNumber;
    	var num2 = $('#right_table2').bootstrapTable('getOptions').pageNumber;
 		if(num>1||num2>1||$("#right_table").height()>=259 ||$("#right_table2").height()>=259){
   		 	$("body").css("overflow-y","scroll");
   	 	}else{
   		 	$("body").css("overflow-y","hidden");
   		 	$('html,body').animate({scrollTop:0},'slow');
   	 	}
     }
</script>
</body>
</html>
