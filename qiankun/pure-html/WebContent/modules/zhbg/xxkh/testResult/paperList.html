<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>企业中心</title>
    <link rel="stylesheet" href="/static/core/bootstrap/css/bootstrap.min.css"/>
    <link rel="stylesheet" href="/static/core/bootstrapvalidator/dist/css/bootstrapValidator.min.css"/>
    <link rel="stylesheet" type="text/css" href="/static/font/iconfont.css">
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="/static/core/html5/html5shiv.min.js"></script>
    <script src="/static/core/html5/respond.js"></script>
    <![endif]-->
    <link href="/static/css/common/style.css" rel="stylesheet"/>
    <link href="/static/css/common/form-public.css" rel="stylesheet"/>
    <link href="/static/core/bootstrap-table/bootstrap-table.css" rel="stylesheet"/>
    <!-- CSS to style the file input field as button and adjust the Bootstrap progress bars -->
    <link rel="stylesheet" href="/static/core/jquery-fileupload/css/jquery.fileupload.css">
</head>

<body class="formpage_bj">
<div class="container-fluid formpage_area" style="min-height: 300px">
        <input type="hidden" id="textId"/>
        <div class="row m-t-15">
            <div class="col-md-12">
                <div id="one">
                    <div class="row">
                        <div class="col-md-12 ">
                            <div class="block_title">
                                <span class="name">试卷列表</span>
                            </div>
                        </div>
                    </div>
                    <p></p>
                    <div class="row m-t-15" style="margin-top: 15px;">
                        <div class="col-md-12 p-f-60">
                            <!--这里表格用的普通表格，要用bootstrap-table（参考列表页面）可以自行修改-->
                            <table id="right_table"></table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- 基本信息结束 -->
</div>
<!-- 按钮区 -->

<!-- 按钮区结束 -->
<script src="/static/core/jquery/jquery-1.11.2.min.js"></script>
<script src="/static/core/bootstrap/js/bootstrap.min.js"></script>
<script src="/static/core/bootstrap-table/bootstrap-table.min.js"></script>
<script src="/static/core/bootstrap-table/locale/bootstrap-table-zh-CN.min.js"></script>
<script src="/static/core/bootstrapvalidator/dist/js/bootstrapValidator.min.js"></script>
<script src="/static/core/layer/layer.js"></script>
<script src="/static/js/common/url.js"></script>
<script src="/static/js/common/mylayer.js"></script>

<script src="/static/core/laydate/laydate.js"></script>

<!--文件上传js-->
<!-- The jQuery UI widget factory, can be omitted if jQuery UI is already included -->
<script src="/static/core/jquery-fileupload/js/vendor/jquery.ui.widget.js"></script>
<!-- The Iframe Transport is required for browsers without support for XHR file uploads -->
<script src="/static/core/jquery-fileupload/js/jquery.iframe-transport.js"></script>
<!-- The basic File Upload plugin -->
<script src="/static/core/jquery-fileupload/js/jquery.fileupload.js"></script>
<script src="/static/js/common/myfilupload.js"></script>
<!--文件上传js end-->
<script src="/static/js/common/tablelist.js"></script>
<!-- 页面获取参数 -->
<script type="text/javascript" src="/common/js/getrequest.js"></script>
<script type="text/javascript">
    //绑定日期输入input
    laydate.render({
        elem: '#birth' //指定元素
    });
</script>
<script type="text/javascript">
    //参考：http://www.layui.com/laydate/
    //绑定日期输入input
    laydate.render({
        elem: '#time' //指定元素
    });
    //日期范围
    laydate.render({
        elem: '#timeRange'
        , range: true
    });


    //定义bootatrap-table数据列
    //    sortable：开启列排序，其他参考API
    var right_table_col = [{
        field: 'id'
        , title: '序号'
        , width: '5%'
        , order: "desc"
        , align:"center"
        ,formatter:function(value,row,index){
            return "<span data-id='"+row.paperId+"'>"+(index+1)+"</span>";    //返回每条的序号： 每页条数 * （当前页 - 1 ）+ 序号
		}
    }, {
        field: 'paperName'
        , title: '试卷名称'
        , width: '20%'
        , align:"center"
        ,formatter:function(value,row,index){
        	if(value!=null){
        		var length = value.length
	  	   	      var val = '';
	  	   	      if(length>12){
	  	   	    	  val = value.substring(0,12)+"...";
	  	   	      }else{
	  	   	    	  val = value;
	  	   	      }
  	   	   		return  "<span title="+value+" data-title='"+row.paperName+"'>"+val+"</span>";
        	}else{
        		return "";
        	}
		}
    }, {
        field: 'isDaTi'
        , title: '是否及格'
        , width: '8%'
        , align:"center"
        ,formatter:function(value,row,index){
        	if(row.paperSubjectiveScore!="" && row.paperObjectiveScore!=""){
	       		var score = parseInt(row.paperObjectiveScore)+parseInt(row.paperSubjectiveScore);
	           	if(score>=parseInt(row.passScore)){
	           		if(row.isZhuGuan=="" ||row.isZhuGuan==null){
	            		return "是";
	           		}else{
	           			if(row.artificialMarkingState=="1"){
	           				return "是";
	           			}else{
		           			return "<span class='nopingjuan'>是</span>";
	           			}
	           		}
	           	}else{
	           		if(row.isZhuGuan=="" ||row.isZhuGuan==null){
	            		return "否";
	           		}else{
	           			if(row.artificialMarkingState=="1"){
	           				return "否";
	           			}else{
		           			return "<span class='nopingjuan'>否</span>";
	           			}
	           		}
	           	}
       	 	}else if(row.paperObjectiveScore=="" ||row.paperObjectiveScore==null){
       	 		var score = parseInt(row.paperSubjectiveScore);
	       	 	if(row.artificialMarkingState=="1"){
	       	 		if(score>=parseInt(row.passScore)){
	       	 			return "是";
	       	 		}else{
		   				return "否";
	       	 		}
	   			}else{
	       			return "<span class='nozhuguan'>否</span>";
	   			}
       	 	}
        }
    },{
    	field: 'paperObjectiveScore'
    	, title: '客观题分数'
    	, sortable: false
    	, width: '8%'
    	, align: "center"
   		,formatter:function(value,row,index){
	   		var score = parseInt(row.paperObjectiveScore);
	   		if(value==null ||value==""){
	   			return "<span class='noObject' >×</span>";
	   		}else{
	           	return score;
	   		}
		}
	},{
	    field: 'paperSubjectiveScore'
	    , title: '主观题分数'
	    , sortable: false
	    , width: '8%'
	    , align: "center"
	   	,formatter:function(value,row,index){
	   		var score = parseInt(row.paperSubjectiveScore);
	   		if(row.isZhuGuan==null ||row.isZhuGuan ==""){
	   			return "<span class='nojianda' >×</span>";
	   		}else{
		   		if(row.paperSubjectiveScore!="" && row.paperSubjectiveScore!=null){
		   			if(row.artificialMarkingState=="1"){
		   				return score;
		   			}else{
			   			return  "<span class='judge'>-</span>";
		   			}
		   		}
	   		}
		}
 	},{
	    field: 'sumScore'
	    , title: '考试分数'
	    , sortable: false
	    , width: '8%'
	    , align: "center"
	   	,formatter:function(value,row,index){
	   		var score = parseInt(row.paperSubjectiveScore);
	   		if(row.paperSubjectiveScore!="" && row.paperSubjectiveScore!=null){
	   			if(row.paperObjectiveScore!="" && row.paperObjectiveScore!=null){
	   				if(row.artificialMarkingState=="1"){
	   					var score = parseInt(row.paperObjectiveScore)+parseInt(row.paperSubjectiveScore);
		   				return "<span>"+score+"</span>";
	   				}else{
	   					var score = parseInt(row.paperObjectiveScore);
	   					return "<span class='objectScore'>-</span>";
	   				}
	   			}else{
	   				return "-";
	   			}
	   		}
		}
 	},{
        field: 'beginTestTime'
        , title: '答题时间'
        , width: '10%'
        , align:"center"
    }];

    $(document).ready(function (e) {
    	var theRequest = GetRequest();
    	//资源id
    	var resId = theRequest.resId;
    	var testId = theRequest.testId;
        //初始化表格
        TableInit.init({
            domId:"right_table",
            url:"/zhbg/xxkh/gradesearch/getPersonalTestPaper",
            columns:right_table_col,
            pagination:true,
            queryParams:function(params){
                //这里将各个查询项添加到要传递的参数中
				params.id = testId;
                return params;
            },
            readOnlyFn:function(){
            	$('tr.readOnly').find('td').attr('title','点击查看详情');
            	$('.nojianda').each(function(){
            		$(this).parent().attr('title','此套试卷无主观题').css('color','red');
            	})
            	$('.judge').each(function(){
            		$(this).parent().attr('title','暂未评卷').css('color','red');
            	})
            	$('.objectScore').each(function(){
            		$(this).parent().attr('title','主观题暂未评卷').css('color','red');
            	})
            	$('.nopingjuan').each(function(){
            		$(this).parent().attr('title','此结果不包含主观题分数').css('color','red');
            	})
            	$('.noObject').each(function(){
            		$(this).parent().attr('title','此套试卷无客观题').css('color','red');
            	})
            	$('.nozhuguan').each(function(){
            		$(this).parent().attr('title','暂未评卷').css('color','red');
            	})
                $('tr.readOnly').find('td').unbind('click').bind('click',function(e){
//                    取消事件冒泡
                    var evt = e ? e : window.event;
                    if (evt.stopPropagation) {
                        evt.stopPropagation();
                    }else {
                        evt.cancelBubble = true;
                    }
//                    取消事件冒泡 end
					var paperId =$(this).parents('tr.readOnly').find('td:eq(0)').find('span[data-id]').attr('data-id'); 
                   // MyLayer.layerOpenUrl({url:'/modules/zhbg/xxkh/testResult/paperWithAnswer.html',title:'试卷查看（附答案）',width:'98%',height:'98%'});
                   MyLayer.layerOpenUrl({url:'/modules/zhbg/xxkh/test/testResult.html?id='+paperId+'&testId='+testId,title:'试卷查看（附答案）',width:'98%',height:'98%'});
                });
            }
        });
    });

    //    表格数据项的操作
    var list = {
            editFun:function(id){
                MyLayer.layerOpenUrl({
                    url:'/modules/zhbg/xxkh/test/beginTest.html?id='+id,
                    title:"参加考试",
                    width:"98%",
                    heigh:"98%"
                })
            }
        }
</script>
<!-- 按钮区 -->
<div class="form_btn_area" style="text-align: center;">
    <button id="preserveBtn" class="btn btn-primary form_btn_area_btn2" onclick="MyLayer.closeOpen();" ><span class="glyphicon glyphicon-remove-circle" aria-hidden="true"></span> 关闭</button>
</div>
<!-- 按钮区结束 -->
</body>
</html>
