<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="Expires" content="0">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Cache-control" content="no-cache">
    <meta http-equiv="Cache" content="no-cache">
    <title></title>
    <link rel="stylesheet" href="/static/core/bootstrap/css/bootstrap.min.css"/>
    <link rel="stylesheet" href="/static/core/bootstrapvalidator/dist/css/bootstrapValidator.min.css"/>
    <link href="/static/css/common/style.css" rel="stylesheet"/>
    <link href="/static/css/common/form-public.css" rel="stylesheet"/>
    <link rel="stylesheet" href="/static/core/jquery-fileupload/css/jquery.fileupload.css">
    
     <!-- Bootstrap -->
    <link href="/static/core/bootstrap/css/bootstrap.css" rel="stylesheet"/>
    <link href="/static/core/bootstrap-table/bootstrap-table.css" rel="stylesheet"/>
    <link rel="stylesheet" type="text/css" href="/static/font/iconfont.css">
    <link rel="shortcut icon" href="/favicon.ico"/>
    <link href="/static/core/bootstrap3-editable/css/bootstrap-editable.css" rel="stylesheet"/>
</head>

<body class="formpage_bj">
<div class="container-fluid formpage_area">
    <form class="form-horizontal" id="form">
       <input type="hidden" id="textId"/>
        	<input name="resId" id="resId" type="hidden" value="">
		<!-- 流程字段-->
		<input name="pid" id="pid" type="hidden" value=""/><!-- 工作项ID -->
		<input name="opertation" id="opertation" type="hidden" value=""/><!-- 操作方法 -->
        <input type="hidden" class="form-control" id="meetingServiceName" name="meetingServiceName">
        <!-- 基本信息 -->
        <div class="row">
            <div class="col-md-12 ">
                <div class="block_title">
                    <span class="name">基本信息</span>
                </div>
            </div>
        </div>
        <div class="row m-t-15">
            <div class="col-md-12">
                <div class="form-group">
                    <label for="" class="col-md-2 control-label">会议标题：</label>
                    <div class="col-md-8 form-view">
                        <span name="applyTitle"></span>
                    </div>
                </div>
               <!--  <div class="form-group">
                    <label for="" class="col-md-2 control-label">会议室：</label>
                    <div class="col-md-4 form-view">
                        <span name="meetingroomName"></span>
                    </div>
                    <label for="" class="col-md-2 control-label">会议地点：</label>
                    <div class="col-md-4 form-view">
                        <span name="meetingPlace"></span>
                    </div>
                </div> -->
                <div class="form-group">
                    <label for="" class="col-md-2 control-label">主办单位：</label>
                    <div class="col-md-4 form-view">
                        <span name="hostDeptName"></span>
                    </div>
                    <label for="" class="col-md-2 control-label">会议时间：</label>
                    <div class="col-md-4 form-view">
                        <span name="meetingTime"></span>
                    </div>
                </div>
                <div class="form-group">
                    <label for="" class="col-md-2 control-label">会务服务：</label>
                    <div class="col-md-10 form-view">
                        <span name="meetingServices" id="meetingServices"></span>
                    </div>
                    <!-- <label for="" class="col-md-2 control-label">结束时间：</label>
                    <div class="col-md-4 form-view">
                        <span name="meetingEndDate"></span>&nbsp;<span name="meetingEndTime"> </span>
                    </div> -->
                </div>
                <div class="form-group">
                    <label for="" class="col-md-2 control-label">备注： </label>
                    <div class="col-md-8 form-view">
                        <span name="remark"></span>
                    </div>
                </div>
                <div class="form-group" id="tablePlan">
                   	<label for="" class="col-md-2 control-label"> 会议室安排：</label>
                    <div class="col-md-10" id="plan">
                      	<table id="center_table"></table>
                    </div>
               	</div>
            </div>
        </div>
        <!-- 基本信息结束 -->
        
        <!-- 反馈信息 -->
        <div class="row">
            <div class="col-md-12 ">
                <div class="block_title">
                    <span class="name">反馈信息</span>
                </div>
            </div>
        </div>
        <!-- 反馈信息结束 -->


    </form>
    
    <!--最外层tab-->
    <div class="modal-body selectjs">
        <div class="selectjs_block" style="height: auto;">
            <div class="title_tab">
                <ul class="nav nav-tabs">
                    <li for="formpage2" class="active">
                        <a href="#" data-toggle="tab">已反馈</a>
                    </li>
                    <li  for="formpage1">
                        <a href="#" data-toggle="tab">未反馈</a>
                    </li>
                </ul>
            </div>
            <div class="main" style="height: auto;">
                <!--tab的主体部分-->
                <div id="formpage2" class="active">
                	<!-- 已反馈的信息 -->
                	<div class="row m-t-15">
            			<div class="col-md-12">
                			<table id="right_table"></table>
            			</div>
        			</div>
                </div>
                <div id="formpage1" class="hidden">
                	<!-- 未反馈的信息 -->
                	<div class="row m-t-15">
            			<div class="col-md-12">
                			<table id="left_table"></table>
            			</div>
        			</div>
                </div>
                <!--</div>-->
            </div>
        </div>
    </div>

    <div class="row m-t-15">
    </div>
    <!--文件上传end-->
</div>

<!-- 按钮区 -->
<!-- <div class="form_btn_area" style="text-align: center;">
    <button id="save" class="btn btn-primary form_btn_area_btn2" onclick="global.save();" ><span class="glyphicon glyphicon-floppy-disk" aria-hidden="true"></span> 保存</button>
    <button id="sendFLow" class="btn btn-primary form_btn_area_btn2" onclick="global.save();" ><span class="glyphicon glyphicon-send" aria-hidden="true"></span> 反馈</button>
</div> -->
<script src="/static/core/jquery/jquery-1.11.2.min.js"></script>
<script src="/static/core/bootstrap/js/bootstrap.min.js"></script>
<script src="/static/core/nodetpl.min.js"></script>
<script src="/static/core/laydate/laydate.js"></script>
<script src="/static/core/layer/layer.js"></script>
<script src="/static/core/bootstrap-table/bootstrap-table.min.js"></script>
<script src="/static/core/bootstrap-table/locale/bootstrap-table-zh-CN.min.js"></script>
<script src="/static/js/common/mylayer.js"></script>
<script src="/static/js/common/tablelist.js"></script>

<script type="text/javascript" src="/common/js/dateutil.js"></script>
<script type="text/javascript" src="/static/js/common/assistUtil.js"></script>
<!-- 获取cookie值 -->
<script type="text/javascript" src="/product/workflow/js/common/getCook.js"></script>
<script type="text/javascript" src="/common/js/getrequest.js"></script>
<script type="text/javascript" src="/message/js/notityMessage.js"></script>

<!-- 流程相关 -->
<script type="text/javascript" src="/common/js/commonFunction.js"></script>
<!-- 获取cookie值 -->
<script type="text/javascript" src="/product/workflow/js/common/getCook.js"></script>
<!-- 页面获取参数 -->
<script type="text/javascript" src="/common/js/getrequest.js"></script>
	<!-- 引入自己模块功能的js -->
<script type="text/javascript" src="js/meetingServiceNoticeEdit.js"></script>
<script type="text/javascript" src="/static/js/common/displayData.js"></script>

<!--文件上传js end-->
<script type="text/javascript">
$(function(){
	var theRequest = GetRequest();
	$("#resId").val(theRequest.resId);
	$("#pid").val(regVlaue(theRequest.id));
	$("#opertation").val(theRequest.oper);
	/**
	 * 初始化页面，数据加载、渲染
	 */
	if($("#pid").val() != ""){
		
		//主表单数据渲染
		var datas = {"id":$("#pid").val(),"resId":$("#resId").val()};
		httpRequest("get","/zhbg/hygl/meetingApply/edit",datas,function (data){
			if(data.data.meetingStartTime=='0'){
				data.data.meetingStartTime='上午';
			}else{
				data.data.meetingStartTime='下午';
			}
			if(data.data.meetingEndTime=='0'){
				data.data.meetingEndTime='上午';
			}else{
				data.data.meetingEndTime='下午';
			}
			DisplayData.playData({data: data});
			//checkbox会议服务
			var meetingServices = data.data.meetingServices.split(",");
			var ar = [];
			$.each(meetingServices, function (i, n) {
				var datas = {"id":n};
				httpRequest("get","/zhbg/hygl/basicSet/meetingService/edit",datas,function (data){
					if(data.data){
						ar.push(data.data.meetingService);
					}
				})
                	
            })
			$("#meetingServices").text(ar.join(", "));
			showMeetingRoom($("#pid").val());
		});
		
		//渲染子表
		//showMeetingServices();
		
	}else{
		//没有pid的时候
		$("#addId").click(function(){
			  var serviceDeptName = $("#serviceDeptName").val(); 
			  if(serviceDeptName == undefined || serviceDeptName == "" || serviceDeptName == null){
				  layer.msg('请先选择会务服务单位',{icon:0});
			  }
		});
		
		$("#deleteId").click(function(){
			layer.msg('请选择要删除的行',{icon:0});
		})
	}
	
})

/**
 * 空值设置
 * @param val
 * @returns
 */
function regVlaue(val){
	if(!val){
		val = "";
	}
	return val;
}
    //绑定日期输入input
    laydate.render({
        elem: '#startTime' //指定元素
    });
    laydate.render({
        elem: '#endTime' //指定元素
    });
    //未反馈
    var left_table_col = [{
        title: '序号'
       , width: '5%'
       , order: "desc"
       , align:"center"
       , formatter: function (value, row, index) {
	       //计算序号，并存放业务ID，及已办事项ID
	       var pageSize=$('#left_table').bootstrapTable('getOptions').pageSize;//通过表的#id 可以得到每页多少条
           var pageNumber=$('#left_table').bootstrapTable('getOptions').pageNumber;//通过表的#id 可以得到当前第几页
           var orderNum = pageSize * (pageNumber - 1) + index + 1;//计算序号
           return "<span data-id='"+row.id+"'>"+orderNum+"</span>";
          }
   	}, {
   		field: 'meetingServiceName'
        , title: '会务服务'
        , width: '10%'
        , align:"center"
    }, {
   		field: 'responsibleUserName'
        , title: '负责人'
        , width: '10%'
        , align:"center"
    }, {
   		field: 'serviceDeptId'
        , title: '负责单位'
        , width: '10%'
        , align:"center"
    }, {
   		field: 'responsibleUserTelephone'
        , title: '联系方式'
        , width: '10%'
        , align:"center"
    }];

   //初始化表格
    $(document).ready(function (e) {
   	    	//初始化表格
       TableInit.init({
           domId:"left_table",
           url:"/zhbg/hygl/meetingServiceNotice/getAllList",
           columns:left_table_col,
           rowStyle: function (row, index) {	//默认样式：居中，鼠标为手
               return {
                   classes: 'readOnly'
                   ,css: {"text-align":"center"}
               };
           },
           queryParams:function(params){
           params.resId = $("#resId").val();
           params.meetingroomApplyId = $("#pid").val();
           params.status = "0";
               return params;
          },
           //暂时屏蔽到只读
          	readOnlyFn:function(){
           	  
           } 
          
       });
   })
    
    
    // 已反馈
    var right_table_col = [{
        title: '序号'
       , width: '5%'
       , order: "desc"
       , align:"center"
       , formatter: function (value, row, index) {
	       //计算序号，并存放业务ID，及已办事项ID
	       var pageSize=$('#right_table').bootstrapTable('getOptions').pageSize;//通过表的#id 可以得到每页多少条
           var pageNumber=$('#right_table').bootstrapTable('getOptions').pageNumber;//通过表的#id 可以得到当前第几页
           var orderNum = pageSize * (pageNumber - 1) + index + 1;//计算序号
           return "<span data-id='"+row.id+"'>"+orderNum+"</span>";
          }
   	}, {
   		field: 'meetingServiceName'
        , title: '会务服务'
        , width: '10%'
        , align:"center"
    }, {
   		field: 'responsibleUserName'
        , title: '负责人'
        , width: '10%'
        , align:"center"
    }, {
   		field: 'serviceDeptId'
        , title: '负责单位'
        , width: '10%'
        , align:"center"
    }, {
   		field: 'responsibleUserTelephone'
        , title: '联系方式'
        , width: '10%'
        , align:"center"
    }, {
   		field: 'isOrNot'
        , title: '能否按时提供'
        , width: '10%'
        , align:"center"
       	, formatter: function (value, row, index) {  //直接定义function,return就是html代码
         	var html = "";
       		if(value=='0'){
       			html = '<span>按时提供</span>'
       		}else if(value=='1'){
       			html = '<span>其他</span>'
       		}else{
       			html = '<span>-</span>'
       		}
            return html;
        }
    }, {
        field: 'remark'
        , title: '备注'
        , width: '15%'
        , align:"center"
    }];

   //初始化表格
    $(document).ready(function (e) {
   	    	//初始化表格
       TableInit.init({
           domId:"right_table",
           url:"/zhbg/hygl/meetingServiceNotice/getAllList",
           columns:right_table_col,
           rowStyle: function (row, index) {	//默认样式：居中，鼠标为手
               return {
                   classes: 'readOnly'
                   ,css: {"text-align":"center"}
               };
           },
           queryParams:function(params){
           params.resId = $("#resId").val();
           params.meetingroomApplyId = $("#pid").val();
           params.status = "1";
               return params;
          },
           //暂时屏蔽到只读
          	readOnlyFn:function(){
           	  
           } 
          
       });
   })
   // 切换标签页
    $(function () {
        // tab页切换
        $('.nav-tabs > li').unbind('click').bind('click', function () {
            var id = $(this).attr('for');
            $(this).addClass('active').siblings('li').removeClass('active');
            $('.main').children().addClass('hidden');
            $('#' + id).removeClass('hidden');
        })
    })
   
   //会议室安排列表
   var center_table_col = [{
	    field: 'id'
	    , title: '序号'
	    , width: '5%'
	    , sortable: false
	    , align:"center"
	    , formatter: function (value, row, index) {
			return "<span data-id='"+row.id+"'>" + (index+1) + "</span>"; //返回每条的序号： 每页条数 * （当前页 - 1 ）+ 序号   
	    }  
	},{
	    field: 'useDate'
	    , title: '会议日期'
	    , width: '8%'
	    , sortable: false
	    , align:"center"
	},{
	    field: 'weekDate'
	    , title:'星期'
	    , width: '8%'
	    , sortable: false
	    , align:"center"
	},{
	    field: 'meetingroomName'
	    , title: '会议室名称'
	    , sortable: false
	    , width: '10%'
	    , align:"center"
	},{
	    field: 'location'
	    , title: '会议室地点'
	    , sortable: false
	    , width: '10%'
	    , align:"center"
	},{
	    field: 'useTime'
	    , title: '会议时间'
	    , sortable: false
	    , width: '10%'
	    , align:"center"
	}]; 
    function showMeetingRoom(id){//会议室申请id
		$("#center_table").bootstrapTable({
           pagination:true,
           striped:true,
           //height:250,
           classes: 'table table-hover',
           fixedColumns: true,//是否固定列
           pageList: "[10, 25, 50, 100]",
           detailView:false,
           columns:center_table_col
		})
		$.ajax({
			type : "get",
			url : "/zhbg/hygl/meetingRoomUseInfo/getByApplyId",
			data : {applyId:id,resId:$("#resId").val()},
			success : function(json) {
				if (json.flag=='1') {
					$('#center_table').bootstrapTable('removeAll');
					$('#center_table').bootstrapTable('load',json.data);
					$('#plan .pull-left').css('display','none')
				}
			}
		}); 
	}    
</script>
</body>
</html>
