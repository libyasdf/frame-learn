<!DOCTYPE html>
<html lang="zh-CN">
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
    
    <meta http-equiv="Expires" content="0">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Cache-control" content="no-cache">
    <meta http-equiv="Cache" content="no-cache">
    
    <title></title>
    <link rel="stylesheet" href="/static/core/bootstrap/css/bootstrap.min.css"/>
    <link rel="stylesheet" href="/static/core/bootstrapvalidator/dist/css/bootstrapValidator.min.css"/>
    <link href="/static/css/common/style.css" rel="stylesheet"/>
    <link href="/static/css/common/form-public.css" rel="stylesheet"/>
    <link rel="stylesheet" href="/static/core/jquery-fileupload/css/jquery.fileupload.css">
    <link rel="stylesheet" href="/static/font/iconfont.css">
    <link rel="stylesheet" type="text/css" href="/static/css/table.css">
    
</head>
<body class="formpage_bj">
<div class="container-fluid formpage_area">
    <form class="form-horizontal" id="form">
    	<input name="resId" id="resId" type="hidden" value="">
		<!-- 流程字段-->
		<input name="pid" id="pid" type="hidden" value=""/><!-- 工作项ID -->
		<input name="opertation" id="opertation" type="hidden" value=""/><!-- 操作方法 -->
		<!-- 流程字段结束 -->
        <!-- 基本信息 -->
        <div class="row">
            <div class="col-md-12 ">
                <div class="block_title">
                    <span class="name">基本信息</span>
                </div>
            </div>
        </div>
        <div class="row m-t-15">
            <div class="col-md-12">
                <div class="form-group">
                    <label for="" class="col-md-2 control-label">会务服务单位：</label>
                    <div class="col-md-4 form-view">
                        <span id="serviceDeptName" name="serviceDeptName"></span>
                        <input type="hidden" id="serviceDeptId" name="serviceDeptId" /><!-- 人员ID隐藏域 -->
                    </div>
                </div>
            </div>
        </div>

        <!-- 正序表格，末行添加 -->
        <div class="row">
            <div class="col-md-12 ">
                <div class="block_title">
                    <span class="name">会务服务项目及联系人</span>
                </div>
            </div>
        </div>
        <div class="row m-t-15">
            <div class="col-md-12 p-f-60">
               <div class="table__scrollable-y">
                   <div class="table__header-wrapper">
                        <table class="table  table-hover  table-striped m-b-0">
                            <thead>
                                <tr>
                                    <th style="width: 5%"  class="text-center">
                                        序号
                                    </th>
                                    <th style="width: 10%" data-field="sex" class="text-center">
                                       会务服务项目
                                    </th>

                                    <th style="width: 15%"  class="text-center">
                                        负责人
                                    </th>
                                    <th style="width: 15%" data-field="age" class="text-center">
                                        负责人联系方式
                                    </th>
                                </tr>
                            </thead>
                        </table>
                   </div>
                   <div class="table_body-wrapper">
                       <table class="table table-hover table-bordered table-striped table-reset js-disk-row" id="otherPeople" style="border: 0px">
                            <tbody>
                            </tbody> 
                        </table>
                    </div>
                </div>
            </div>
        </div>
        <br>
    </form>
   
</div>
<!-- 按钮区 -->
<div class="form_btn_area" style="text-align: center;">
   <button id="preserveBtn" class="btn btn-primary form_btn_area_btn2" onclick="MyLayer.closeOpen();" ><span class="glyphicon glyphicon-remove-circle" aria-hidden="true"></span>关闭</button>
</div>
<!-- 按钮区结束 -->

<script src="/static/core/jquery/jquery-1.11.2.min.js"></script>
<script src="/static/core/jquery-serializejson/jquery.serializejson.js"></script>
<script src="/static/core/bootstrap/js/bootstrap.min.js"></script>
<script type="text/javascript" src="/static/core/nodetpl.min.js"></script>
<script type="text/javascript" src="/static/js/common/jquery-util.js"></script>
<script type="text/javascript" src="/static/core/layer/layer.js"></script>
<script type="text/javascript" src="/static/js/common/autoCheckForm.js"></script>
<script type="text/javascript" src="/modules/system/component/tree/js/deptUserTree.js"></script>

<script type="text/javascript" src="/static/js/common/assistUtil.js"></script>
<!-- 弹框 -->
<script src="/static/js/common/mylayer.js"></script>
<!-- 流程相关 -->
<script type="text/javascript" src="/common/js/commonFunction.js"></script>
<!-- 获取cookie值 -->
<script type="text/javascript" src="/product/workflow/js/common/getCook.js"></script>
<!-- 页面获取参数 -->
<script type="text/javascript" src="/common/js/getrequest.js"></script>
<!-- 引入自己模块功能的js -->
<script type="text/javascript" src="js/meetingServiceEdit.js"></script>
<!-- 数据校验 -->
<script type="text/javascript" src="js/meetingServiceValidator.js"></script>
<!-- 数据回显 -->
<script type="text/javascript" src="/static/js/common/displayData.js"></script>


<script name="main" type="text/template">
    <?for(var i = 0; i < @data.length; i++) {?>
    <tr id="<?=@data[i].id?>">
        <td class="text-center" name="numName" style="width: 5%"><?=(i+1)?></td>
		<td class="text-center" style="width: 10%">
           <?=@data[i].meetingService?>
        </td>
        <td class="text-center" style="width: 15%">
		    	<?=@data[i].responsibleUserName?>
        </td>
		<td class="text-center" style="width: 15%">
        	<?=@data[i].responsibleUserTelephone?>
        </td>
		
    </tr>
  <?}?>
</script>
<script type="text/javascript">

     var subTableLineNum = $("#otherPeople").find("tr").length;

    // 保存按钮事件
    function saveData(){
        var checkResult = aotoCheckForm.check($("#otherPeople").find("tr").find("input,select,textarea").not(':hidden'));
        //校验
         if(checkResult){
        	 getFormData2();
        } 
    }

    //将主子表数据封装为json格式
    function getFormData2(){
        var datas = JSON.stringify(getData());
        $.ajax({
    		type: "POST",
    		url:"/zhbg/hygl/basicSet/meetingService/saveForm",
    		data:datas,
    		dataType: 'json',
    		contentType:"application/json",
    		success:function(result){
    			console.log(result);
    			 if(result){
            		 if(result.flag == "1"){
            			 var data = result.data;
            			 layer.msg("保存成功！", {icon: 1});
            			 parent.TableInit.refTable('right_table');
            			 //循环加载子表
            			 showTable(data);
    	             }
            	 }
    		}
    	});
    }
    
    // 处理子表数据
    function getData(){
    	var deviceInfo = {
            serviceDeptId : $('[name="pid"]').val(),//会务服务单位id
            meetingServiceList : new Array()//子表1信息
        };//需要提交到后台的数据

		//遍历页面中子表1信息 形成 subTableList
		var $subTableRows = $('#otherPeople').find("tr");//所有子表信息行
		$subTableRows.each(function (i,index) {
		    var disk = {
		    	meetingServiceId : $(index).find('[name="meetingServiceId"]').val(),
		    	responsibleUserId : $(index).find('[name="responsibleUserId"]').val(),
		    	responsibleUserName : $(index).find('[name="responsibleUserName"]').val(),
		    	responsibleUserTelephone : $(index).find('[name="responsibleUserTelephone"]').val(),
		    	meetingService : $(index).find('[name="meetingService"]').val()
		    }
		    deviceInfo.meetingServiceList.push(disk);
		});
		//以下输出对象deviceInfo 就是完整的请求报文
		return deviceInfo;
    }
   
</script>
</body>
</html>
