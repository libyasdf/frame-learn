<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <meta http-equiv="Expires" content="0">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Cache-control" content="no-cache">
    <meta http-equiv="Cache" content="no-cache">

    <title></title>
    <link rel="stylesheet" type="text/css" href="/static/css/common/Loading.css">
    <link rel="stylesheet" href="/static/core/bootstrap/css/bootstrap.min.css"/>
    <link rel="stylesheet" href="/static/core/bootstrapvalidator/dist/css/bootstrapValidator.min.css"/>
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="/static/core/html5/html5shiv.min.js"></script>
    <script src="/static/core/html5/respond.js"></script>
    <![endif]-->
    <link href="/static/css/common/style.css" rel="stylesheet"/>
    <link href="/static/css/common/form-public.css" rel="stylesheet"/>
    <!-- CSS to style the file input field as button and adjust the Bootstrap progress bars -->
    <link rel="stylesheet" href="/static/core/jquery-fileupload/css/jquery.fileupload.css">
    <link rel="stylesheet" href="/static/font/iconfont.css">
    <link rel="stylesheet" type="text/css" href="/static/css/table.css">
</head>
<body class="formpage_bj">
<form class="form-horizontal" id="form">
    <!-- resId -->
    <input name="resId" id="resId" type="hidden" value="">
    <!-- 流程字段-->
    <input name="id" id="id" type="hidden" value=""/><!-- 工作项ID -->
    <input name="ideaName" id="ideaName" type="hidden" value=""/><!-- 当前用户意见域名称-->
    <input name="filetypeid" id="filetypeid" type="hidden" value=""/><!-- 流程ID -->
    <input name="workFlowId" id="workflowid" type="hidden" value=""/><!-- 流程唯一ID -->
    <input name="workitemid" id="workitemid" type="hidden" value=""/><!-- 待办工作项ID -->
    <input name="opertation" id="opertation" type="hidden" value=""/><!-- 操作方法 -->
    <input type="hidden" id="deptId" name="deptId" value=""/><!-- 部门id隐藏域 -->
    <input type="hidden" id="fillmode" name="fillmode" value="2">
    <input type="hidden" id="title" name="title">
    <input type="hidden" id="isBorrowFlag" name="isBorrowFlag" value="0">
    <input type="hidden" id="nodeFlag" name="nodeFlag">
    <input type="hidden" id="fileNum" name="fileNum" value="0">
    <input type="hidden" id="disabledFlag" name="disabledFlag" value="0">
    <input type="hidden" id="isChuAdmin" name="isChuAdmin">
    <input type="hidden" id="finishButton" name="finishButton" value="false">
    <input type="hidden" id="isPassLjdw" name="isPassLjdw" value="">
    <input type="hidden" id="isInnewOrReborrow" name="isInnewOrReborrow" value="">

    <!-- 流程字段结束 -->
    <!--<div class="container-fluid formpage_idea">
        <div class="gw_form_block">
            <div class="gw_form_block_title">借阅人相关信息</div>
            <div class="gw_form_block_main">
               &lt;!&ndash; <table width="90%" border="0" cellspacing="0" cellpadding="0" class="gw_form_block_table">
                    <tbody>
                    <tr>
                        <td width="15%" class="text-right">节点操作提示：</td>
                        <td width="85%" id="flowMemo"></td>
                    </tr>
                    </tbody>
                </table>&ndash;&gt;
            </div>
        </div>
       &lt;!&ndash; <div class="gw_form_block">
            <div class="gw_form_block_title" onclick="showTable('yjxxTable','showOrHideImg');">
                意见信息
                <img align="right" style="margin-top: 10px" src="/static/images/icon7_down.gif" hspace="0"
                     id="showOrHideImg"/>
            </div>
            &lt;!&ndash;<div class="dh-left col-xs-1" style="width: 50px" onclick="showTable('yjxxTable','showOrHideImg');"></div>&ndash;&gt;
            <div class="gw_form_block_main" id="yjxxTable">
                <div class="table_body-wrapper">
                    <table class="table table-hover table-reset js-disk-row" style="border: 0px">
                        <tbody>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>&ndash;&gt;
    </div>-->
    <div class="container-fluid formpage_area" style="margin-bottom: 140px">
        <!-- 基本信息 -->
        <div class="row">
            <div class="col-md-12 ">
                <div class="block_title">
                    <span class="name">借阅信息</span>
                </div>
            </div>
        </div>
        <div class="row m-t-15">
            <div class="col-md-12">
                <div class="form-group">
                    <div class="rowGroup">
                        <label class="col-md-2 control-label"><b style="color: red;">*</b> 借阅人：</label>
                        <div class="col-md-4">
                            <div class="input-group">
                                <input type="text" id="borrowUserName" unselectable="on" onchange="getDeptInfo('borrowUser');"
                                       onclick=openSelectZtree({'id':'borrowUserId','name':'borrowUserName','parentId':'borrowUnitId','parentName':'borrowUnitName','check':'','cancle':'','cascabe':'1','isMulti':'1','type':'1','select':true,'asyn':true,'url':'/system/component/tree/getDeptAndUserBydeptId'})
                                       name="borrowUserName" class="form-control">
                                <input type="hidden" id="borrowUserId" name="borrowUserId"/><!-- 人员ID隐藏域 -->
                                <input type="hidden" id="borrowDeptId" name="borrowDeptId"/>
                                <input type="hidden" id="borrowDeptName" name="borrowDeptName"/>
                                <span class="input-group-addon"
                                      onclick=openSelectZtree({'id':'borrowUserId','name':'borrowUserName','parentId':'borrowUnitId','parentName':'borrowUnitName','check':'','cancle':'','cascabe':'1','isMulti':'1','type':'1','select':true,'asyn':true,'url':'/system/component/tree/getDeptAndUserBydeptId'})>
                                      <span class="glyphicon glyphicon-user"></span>
                                  </span>
                            </div>
                        </div>
                    </div>
                    <div class="rowGroup">
                        <label class="col-md-2 control-label"><b style="color: red;">*</b> 借阅单位：</label>
                        <div class="col-md-4">
                            <input  type="text" id="borrowUnitName"  unselectable="on" name="borrowUnitName"
                                   class="form-control" readonly="readonly">
                            <input type="hidden" id="borrowUnitId" name="borrowUnitId"/><!-- 人员ID隐藏域 -->
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <div class="rowGroup">
                        <label class="col-md-2 control-label"><b style="color: red;">*</b> 电话：</label>
                        <div class="col-md-4">
                            <input type="text" class="form-control" id="phone" name="phone">
                        </div>
                    </div>
                    <div class="rowGroup">
                        <label class="col-md-2 control-label"><b style="color: red;">*</b> 借阅类型：</label>
                        <div class="col-md-4" id="flowType">
                            <label class="radio-inline">
                                <input type="radio" id="flowType1" checked onclick="flowTypeChange('1');"
                                       name="flowType" value="1">
                                借阅本单位
                            </label>
                            <label class="radio-inline">
                                <input type="radio" id="flowType2" onclick="flowTypeChange('1');" name="flowType"
                                       value="2">
                                借阅非本单位
                            </label>
                        </div>
                    </div>
                </div>

                <div class="form-group">

                    <div class="rowGroup">
                        <label class="col-md-2 control-label"><b style="color: red;">*</b> 审批人：</label>
                        <div class="col-md-4">
                            <div class="input-group">
                                <input type="text" id="approveUserName" unselectable="on" onchange="getDeptInfo('approveUser');"
                                       onclick=openSelectZtree({'id':'approveUserId','name':'approveUserName','parentId':'approveUnitId','parentName':'approveUnitName','check':'','cancle':'','cascabe':'1','type':'1','select':true,'asyn':true,'url':'/system/component/tree/getDeptAndUserBydeptId'})
                                       name="approveUserName" class="form-control">
                                <input type="hidden" id="approveUserId" name="approveUserId"/><!-- 人员ID隐藏域 -->
                                <span class="input-group-addon"
                                      onclick=openSelectZtree({'id':'approveUserId','name':'approveUserName','parentId':'approveUnitId','parentName':'approveUnitName','check':'','cancle':'','cascabe':'1','type':'1','select':true,'asyn':true,'url':'/system/component/tree/getDeptAndUserBydeptId'})>
                                      <span class="glyphicon glyphicon-user"></span>
                                  </span>
                            </div>
                        </div>
                    </div>
                    <div class="rowGroup">
                        <label class="col-md-2 control-label"><b style="color: red;">*</b> 审批单位：</label>
                        <div class="col-md-4">
                            <input type="text" id="approveUnitName" unselectable="on" name="approveUnitName" class="form-control" readonly="readonly">
                            <input type="hidden" id="approveUnitId" name="approveUnitId"/><!-- 人员ID隐藏域 -->
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <div class="rowGroup">
                        <label class="col-md-2 control-label"><b style="color: red;">*</b> 利用目的：</label>
                        <div class="col-md-10">
                            <textarea name="usePurpose" id="usePurpose" class="form-control" rows="6"></textarea>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <div class="rowGroup">
                        <label for="" class="col-md-2 control-label">借阅内容说明:</label>
                        <div class="col-md-10">
                            <textarea name="remark" id="remark" class="form-control" rows="6"></textarea>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- 基本信息结束 -->
        <div class="row fileList">
            <div class="col-md-12 ">
                <div class="block_title">
                    <span class="name">档案信息</span>
                </div>
            </div>
        </div>
        <div class="row m-t-15 fileList">
            <div class="col-md-12 p-f-60">
                <!-- 功能按钮区域-->
                <div style='margin-bottom: 3px'>
                    <button class="list_table_btn2 addTR" type="button" id='addId'>
                        <span class="glyphicon glyphicon-plus-sign"></span> 添加
                    </button>
                    <button class="list_table_btn2 allDelete" type="button" id="deleteId">
                        <span class="glyphicon glyphicon-remove"></span> 删除
                    </button>
                    <button class="list_table_btn2 " onclick="searchData();" type="button" id="searchId">
                        <span class="glyphicon glyphicon-search"></span> 档案检索
                    </button>
                </div>
                <div class="table__scrollable-y">
                    <div class="table__header-wrapper">
                        <table class="table table-hover table-striped m-b-0">
                            <thead>
                            <tr>
                                <th style="width: 3%" class="text-center" class="deleteCheckBox">
                                    <input type="checkbox" id="checkboxSuccess" class="deleteCheckBox" value="option1">
                                </th>
                                <th style="width: 3%" class="text-center">
                                    序号
                                </th>
                                <th style="width: 3%" class="text-center">
                                    状态
                                </th>
                                <th style="width: 6%" data-field="fileCategory" class="text-center">
                                    门类名称
                                </th>
                                <th style="width: 8%" data-field="archiveNo" class="text-center">
                                    档号
                                </th>
                                <th style="width: 8%" data-field="fileNumber" class="text-center">
                                    题名
                                </th>
                                <th style="width: 6%" data-field="fileName" class="text-center">
                                    立卷单位
                                </th>
                                <th style="width: 6%" data-field="securityClass" class="text-center">
                                    密级
                                </th>
                                <th style="width: 8%" data-field="pageNum" class="text-center">
                                    页数
                                </th>
                            </tr>
                            </thead>
                        </table>
                    </div>
                    <div class="table_body-wrapper">
                        <table class="table table-hover table-striped table-reset js-disk-row" id="otherPeople"
                               style="border: 0px">
                            <tbody>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</form>
<!--意见信息start-->
<div class="container-fluid gw_form_bottom_yijian" id="ideaArea" style="display: none;margin-bottom: 50px;">
    <table width="100%" border="0" cellspacing="0" cellpadding="0" class="gw_form_bottom_table  mt_10">
        <tr>
            <td width="15%" class="title">我的意见：</td>
            <td width="85%">
                <table>
                    <tr>
                        <td rowspan="2" width="90%">
                                <textarea name="textarea" id="idea" cols="45" rows="3" placeholder="意见最多填写200字"
                                          class="form_textarea" style="width: 100%;"
                                          onkeyup="this.value = this.value.substring(0,200)"></textarea>
                            <span id="idea-count" value="">0</span>/200
                        </td>
                        <td width="10%">
                            <select class="btn btn-default" name="CuOpinion" id="CuOpinion"
                                    onchange="onSelect(this.value,'idea')"></select>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <a class="white" href="#" onclick="add('idea')">+添加常用意见</a></td>
                        </td>
                    </tr>
                </table>
            </td>
        </tr>
    </table>
</div>
<!--意见信息end-->
<!--
<div class="gw_form_right_btn_area" style=" right: 20px; top: 20px; position: fixed;">
    <ul>
        <li><a href="#" onclick="openLayer('1')"><span class="glyphicon glyphicon-list-alt" aria-hidden="true"></span>
            流程记录</a></li>
        <li><a href="#" onclick="openLayer('2')"><span class="glyphicon glyphicon-random" aria-hidden="true"></span> 流程图</a>
        </li>
        <li><a href="#" onclick="openLayer('3')"><span class="glyphicon glyphicon-pencil" aria-hidden="true"></span>
            意见信息</a></li>
    </ul>
</div>
-->
<!--<div class="form_btn_area" style="text-align: center;">
    <a href="#" id="save" onclick="commitForm();" class="form_btn_blue form_btn_area_btn" style="width: 140px"><span class="glyphicon glyphicon-floppy-disk" aria-hidden="true"></span> 保存</a>
    <a href="#" id="sendFLow" onclick="commitFlow();" class="form_btn_blue form_btn_area_btn" style="width: 140px"><span class="glyphicon glyphicon-send" aria-hidden="true"></span> 发送</a>
    <a href="#" id="approval" onclick="completeFlow('',Config.approvalflag)" class="form_btn_blue form_btn_area_btn" style="display: none;width: 140px"><span class="glyphicon glyphicon-ok" aria-hidden="true"></span> 通过</a>
    <a href="#" id="noApproval" onclick="completeFlow('',Config.noApprovalflag)" class="form_btn_blue form_btn_area_btn" style="display: none;width: 140px "><span class="glyphicon glyphicon-remove" aria-hidden="true"></span> 不通过</a>
    <a href="#" id="remove" onclick="removeFlow()"><span class="glyphicon glyphicon-ban-circle" aria-hidden="true"></span> 撤办</a></li>
    <a href="#" id="resumeFlow" onclick="resumeFlow()"><span class="glyphicon glyphicon-repeat" aria-hidden="true"></span> 重新启用</a></li>
    <a href="#" id="takeBack"  onclick="takeBack()"><span class="glyphicon glyphicon-repeat" aria-hidden="true"></span> 收回重办</a></li>
</div>
btn-primary
-->
<div class="form_btn_area" style="text-align: center;" id = "buttonDiv">
</div>
<!-- 按钮区结束 -->
<script src="/static/core/jquery/jquery-1.11.2.min.js"></script>
<script src="/static/core/bootstrap/js/bootstrap.min.js"></script>
<script src="/static/core/bootstrap-table/bootstrap-table.min.js"></script>
<script src="/static/core/bootstrap-table/locale/bootstrap-table-zh-CN.min.js"></script>
<script src="/static/core/bootstrapvalidator/dist/js/bootstrapValidator.min.js"></script>
<script src="/static/core/layer/layer.js"></script>
<script src="/static/js/common/mylayer.js"></script>
<script type="text/javascript" src="/static/js/common/assistUtil.js"></script>

<script src="/static/core/laydate/laydate.js"></script>
<!-- 流程相关 -->
<script type="text/javascript" src="/modules/system/component/tree/js/deptUserTree.js"></script>
<script type="text/javascript" src="/common/js/config.js"></script>
<script type="text/javascript" src="/product/workflow/js/storages.js"></script>
<script type="text/javascript" src="/common/js/commonFunction.js"></script>
<!-- 获取cookie值 -->
<script type="text/javascript" src="/product/workflow/js/common/getCook.js"></script>
<!-- 页面获取参数 -->
<script type="text/javascript" src="/common/js/getrequest.js"></script>

<!-- 引入自己模块功能的js -->
<script type="text/javascript" src="/modules/dagl/daly/borrow/borrowmanage/js/traditionalRegisterEdit.js"></script>
<!-- 自定义意见(最后进行加载) -->
<script type="text/javascript" src="/common/html/notion/notion.js"></script>
<!-- 数据校验 -->
<script type="text/javascript" src="/modules/dagl/daly/borrow/borrowmanage/js/traditionalRegisterValidator.js"></script>
<!-- 数据回显 -->
<script type="text/javascript" src="/static/js/common/displayData.js"></script>
<!--点击折叠展开-->
<script type="text/javascript" src="/static/js/common/toggle.js"></script>
<script type="text/javascript" src="/static/core/nodetpl.min.js"></script>
<script type="text/javascript" src="/static/core/jquery-serializejson/jquery.serializejson.min.js"></script>
<script type="text/javascript" src="/modules/dagl/daly/borrow/borrowmanage/js/jquery-util.js"></script>
<script type="text/javascript" src="/static/js/common/autoCheckForm.js"></script>
<script name="main" type="text/template">
    <?for(var i = 0; i < @data.length; i++) {?>
    <tr id="<?=@data[i].id?>">
        <td class="text-center" style="width: 3%">
            <input type="checkbox" name="checkboxName" class="deleteCheckBox" value="option1">
        </td>
        <td class="text-center" name="numName" style="width: 3%"><?=(i+1)?></td>
        <?if(@data[i].isBorrow=="借出") {?>
        <td class="text-center" style="width: 3%;color: red;">
            <input id="isBorrow<?=(i+1)?>" type="hidden" name="isBorrow" value="<?=@data[i].isBorrow?>">
            <span name="isBorrow"><?=@data[i].isBorrow?></span>
        </td>
        <?}?>
        <? if(@data[i].isBorrow=="部分借出") {?>
        <td class="text-center" style="width: 3%;color: blue;">
            <input id="isBorrow<?=(i+1)?>" type="hidden" name="isBorrow" value="<?=@data[i].isBorrow?>">
            <span  name="isBorrow"><?=@data[i].isBorrow?></span>
        </td>
        <?}?>
        <? if(@data[i].isBorrow=="未借出") {?>
        <td class="text-center" style="width: 3%;color: green;">
            <input id="isBorrow<?=(i+1)?>" type="hidden" name="isBorrow" value="<?=@data[i].isBorrow?>">
            <span  name="isBorrow"><?=@data[i].isBorrow?></span>
        </td>
        <?}?>
        <?if(@data[i].isBorrow==""||@data[i].isBorrow=="未入库"){?>
        <td class="text-center" style="width: 3%;">
            <input id="isBorrow<?=(i+1)?>" type="hidden" name="isBorrow" value="未入库">
            <span  name="isBorrow">未入库</span>
        </td>
        <?}?>

        <?if(@data[i].isBorrow==""||@data[i].isBorrow=="未入库"){?>
            <td class="text-center" style="width: 6%">
                <input type="hidden" id="id<?=(i+1)?>" name="id" value="<?=@data[i].id ?>">
                <input type="hidden" id="recid<?=(i+1)?>" name="recid" value="<?=@data[i].recid ?>">
                <input type="hidden" id="tableName<?=(i+1)?>" name="tableName" value="<?=@data[i].tableName ?>">
                <input type="hidden" id="categoryNo<?=(i+1)?>" name="categoryNo" value="<?=@data[i].categoryNo ?>">
                <select id="categoryName<?=(i+1)?>" CK_info="门类名称" CK_type="ck_required" placeholder="请选择门类名称"
                        class="form-control" value="<?=@data[i].categoryName ?>" name="categoryName" >
                </select>
            </td>
        <?}else{?>
        <td class="text-center" style="width: 6%">
            <input type="hidden" id="id<?=(i+1)?>" name="id" value="<?=@data[i].id ?>">
            <input type="hidden" id="recid<?=(i+1)?>" name="recid" value="<?=@data[i].recid ?>">
            <input type="hidden" id="tableName<?=(i+1)?>" name="tableName" value="<?=@data[i].tableName ?>">
            <input type="hidden" id="categoryNo<?=(i+1)?>" name="categoryNo" value="<?=@data[i].categoryNo ?>">
            <select id="categoryName<?=(i+1)?>" CK_info="门类名称" CK_type="ck_required" placeholder="请选择门类名称"
                    class="form-control" value="<?=@data[i].categoryName ?>" name="categoryName" disabled="disabled">
            </select>
        </td>
        <?}?>

        <?if(@data[i].isBorrow==""||@data[i].isBorrow=="未入库"){?>
        <td class="text-center" style="width: 8%">
            <input type="text" id="archiveNo<?=(i+1)?>" CK_info="档号" CK_type="ck_required,ck_max" ck_max="100"
                   placeholder="请输入档号" class="form-control" value="<?=@data[i].archiveNo ?>"
                   name="archiveNo">
        </td>
        <?}else{?>
        <td class="text-center" style="width: 8%">
            <input type="text" id="archiveNo<?=(i+1)?>" CK_info="档号" CK_type="ck_required,ck_max" ck_max="100"
                   placeholder="请输入档号" class="form-control" value="<?=@data[i].archiveNo ?>"
                   name="archiveNo" readonly>
        </td>
        <?}?>

        <?if(@data[i].isBorrow==""||@data[i].isBorrow=="未入库"){?>
        <td class="text-center" style="width: 8%">
            <input type="text" id="mainTitle<?=(i+1)?>" CK_type="ck_required,ck_max" ck_max="200" CK_info="题名"
                   placeholder="请输入题名" class="form-control" value="<?=@data[i].mainTitle ?>"
                   name="mainTitle">
        </td>
        <?}else{?>
        <td class="text-center" style="width: 8%">
            <input type="text" id="mainTitle<?=(i+1)?>" CK_type="ck_required,ck_max" ck_max="200" CK_info="题名"
                   placeholder="请输入题名" class="form-control" value="<?=@data[i].mainTitle ?>"
                   name="mainTitle" readonly>
        </td>
        <?}?>

        <?if(@data[i].isBorrow==""||@data[i].isBorrow=="未入库"){?>
        <td class="text-center" style="width: 6%">
            <select id="ljdwMark<?=(i+1)?>" CK_info="立卷单位" CK_type="ck_required" placeholder="请选择立卷单位"
                    class="form-control" value="<?=@data[i].ljdwMark ?>" name="ljdwMark">
            </select>
        </td>
        <?}else{?>
        <td class="text-center" style="width: 6%">
            <select id="ljdwMark<?=(i+1)?>" CK_info="立卷单位" CK_type="ck_required" placeholder="请选择立卷单位"
                    class="form-control" value="<?=@data[i].ljdwMark ?>" name="ljdwMark" disabled="disabled">
            </select>
        </td>
        <?}?>

        <?if(@data[i].isBorrow==""||@data[i].isBorrow=="未入库"){?>
        <td class="text-center" style="width: 6%">
            <select id="securityClass<?=(i+1)?>" CK_info="密级" CK_type="ck_required" placeholder="请选择密级"
                    class="form-control" value="<?=@data[i].securityClass ?>" name="securityClass">
            </select>
        </td>
        <?}else{?>
        <td class="text-center" style="width: 6%">
            <select id="securityClass<?=(i+1)?>" CK_info="密级" placeholder="请选择密级"
                    class="form-control" value="<?=@data[i].securityClass ?>" name="securityClass" disabled="disabled">
            </select>
        </td>
        <?}?>

        <?if(@data[i].isBorrow==""||@data[i].isBorrow=="未入库"){?>
        <td class="text-center" style="width: 8%">
            <input type="text" id="pageNum<?=(i+1)?>" CK_type="ck_required" CK_info="页数"
                   placeholder="请输入页数" class="form-control" value="<?=@data[i].pageNum ?>"
                   name="pageNum">
        </td>
        <?}else{?>
        <td class="text-center" style="width: 8%">
            <input type="text" id="pageNum<?=(i+1)?>" CK_info="页数"
                   placeholder="请输入页数" class="form-control" value="<?=@data[i].pageNum ?>"
                   name="pageNum" readonly>
        </td>
        <?}?>
    </tr>
    <?}?>
</script>
<script type="text/javascript">
    scrollTop.init();
</script>
<script type="text/javascript">
    $(function () {
        // 初始化参数
        var theRequest = GetRequest();
        $("#resId").val(theRequest.resId ? theRequest.resId : "");
        if (theRequest.resId) {
            $("#resId").val(theRequest.resId);
        } else {
            $("#resId").remove();
        }
        if ($("#id").val() == "") {
            $("#deptId").val(getcookie("deptid"));
        }
        if(theRequest.flag =="1"){
            //借阅记录里点击的修改
            $("#buttonDiv").html('<button id="save" class="btn btn-primary form_btn_area_btn2" onclick="commitForm()">' +
                '                   <span class="glyphicon glyphicon-floppy-disk" aria-hidden="true"></span> 保存\n' +
                '                   </button>' +
                '                   <button id="closeButton" class="btn btn-primary form_btn_area_btn2" onclick="closeIfram();" >' +
                '                       <span class="glyphicon glyphicon-remove-circle" aria-hidden="true"></span> 关闭' +
                '                   </button>');

        }else{
            //传统借阅列表点击的修改
            $("#buttonDiv").html('<button id="save" class="btn btn-primary form_btn_area_btn2" onclick="commitForm()"><span\n' +
                '            class="glyphicon glyphicon-floppy-disk" aria-hidden="true"></span> 暂存\n' +
                '    </button>\n' +
                '    <button id="borrow" class="btn btn-primary form_btn_area_btn2" onclick="verifyBorrowUser()"><span\n' +
                '            class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span> 借出\n' +
                '    </button>');
        }
    });

    function searchData() {
        var resId = $('#left_ul').find('a.active').attr("id");
        layer.open({
            type: 2,
            content: '/modules/dagl/bmgl/indexDangAnFind.html?type=register',
            area: ['95%', '100%'],
            offset: '20px',
            title: ['档案检索', 'font-size:16px;font-weight:bold;'],
            resize: true,
            maxmin: true,
            success: function (layero, index) {
                var body = layer.getChildFrame('body', index);
                var iframeWin = window[layero.find('iframe')[0]['name']];
                //  在新版本中新增样式  （修改bugfree 34337）
                if (parent.Api) {  // 判断是不是新版本
                    var styleEle = iframeWin.document.getElementById('pageThreeStyle');
                    if (styleEle) {
                        styleEle.href = '/dist/noBuild/skins/skin_blue/pageThree.css';
                    } else {
                        var head = iframeWin.document.getElementsByTagName('head')[0];
                        var link = iframeWin.document.createElement('link');
                        link.type='text/css';
                        link.rel = 'stylesheet';
                        link.href = '/dist/noBuild/skins/skin_blue/pageThree.css';
                        id ? link.id = 'pageThreeStyle' : '';
                        head.appendChild(link);
                    }
                }
            },
            end: function () {
            }
        });
    }

    function getImportData() {
        fileList.splice(0, fileList.length);
        var daglImportData = [];
        var data = sessionStorage.getItem('daglSearchImportData');
        if (data && data.length > 0) {
            var arr = data.split('$$$');
            for (var a = 0; a < arr.length; a++) {
                daglImportData.push(JSON.parse(arr[a]))
            }
        }
        var $subTableRows = $('#otherPeople').find("tr");//所有子表信息行
        $subTableRows.each(function (i, index) {
            var file = {
                id: $(index).find('[name="id"]').val(),
                isBorrow: $(index).find('[name="isBorrow"]').val(),
                recid: $(index).find('[name="recid"]').val(),
                categoryNo: $(index).find('[name="categoryNo"]').val(),
                categoryName: $(index).find('[name="categoryName"]').find("option:selected").text(),
                archiveNo: $(index).find('[name="archiveNo"]').val(),
                mainTitle: $(index).find('[name="mainTitle"]').val(),
                basefolderUnit: $(index).find('[name="ljdwMark"]').find("option:selected").text(),
                ljdwMark: $(index).find('[name="ljdwMark"]').val(),
                tableName: $(index).find('[name="tableName"]').val(),
                securityClass: $(index).find('[name="securityClass"]').val(),
                pageNum: $(index).find('[name="pageNum"]').val(),
                orderNum: i
            };
            if (file.categoryName != "" || file.archiveNo != "" || file.mainTitle != "" || file.ljdwMark != ""
                && file.basefolderUnit != "" || file.recid != "" || file.categoryNo != "" || file.tableName != "") {
                fileList.push(file);
            }
        });
        if (daglImportData.length > 0) {
            for (var i = 0; i < daglImportData.length; i++) {
                var count = 0;
                if (fileList.length > 0) {
                    for (var j = 0; j < fileList.length; j++) {
                        if (daglImportData[i].recid != fileList[j].recid) {
                            count++;
                        }
                        if (count == fileList.length) {
                            daglImportData[i].isBorrow="未借出";
                            fileList.push(daglImportData[i]);
                        }
                    }
                } else {
                    daglImportData[i].isBorrow="未借出";
                    fileList.push(daglImportData[i]);
                }
            }
            iniTable();
        }
        layer.msg("档案信息导入成功！", {icon: 1});
        //layer.close(layer.index);
        sessionStorage.removeItem('daglSearchImportData');
    }

    function borrow() {
        var index = parent.layer.getFrameIndex(window.name); //先得到当前iframe层的索引
        parent.layer.title('档案检索起草', index);
        fileList.splice(0, fileList.length);
        var daglBorrowData = [];
        var data = sessionStorage.getItem('daglSearchBorrowData');
        if (data && data.length > 0) {
            var arr = data.split('$$$');
            for (var a = 0; a < arr.length; a++) {
                daglBorrowData.push(JSON.parse(arr[a]))
            }
        }
        var $subTableRows = $('#otherPeople').find("tr");//所有子表信息行
        $subTableRows.each(function (i, index) {
            var file = {
                id: $(index).find('[name="id"]').val(),
                isBorrow: $(index).find('[name="isBorrow"]').val(),
                recid: $(index).find('[name="recid"]').val(),
                categoryNo: $(index).find('[name="categoryNo"]').val(),
                categoryName: $(index).find('[name="categoryName"]').val(),
                archiveNo: $(index).find('[name="archiveNo"]').val(),
                mainTitle: $(index).find('[name="mainTitle"]').val(),
                basefolderUnit: $(index).find('[name="ljdwMark"]').find("option:selected").text(),
                ljdwMark: $(index).find('[name="ljdwMark"]').val(),
                tableName: $(index).find('[name="tableName"]').val(),
                orderNum: i
            };
            if (file.categoryName != "" || file.archiveNo != "" || file.mainTitle != "" || file.ljdwMark != ""
                && file.basefolderUnit != "" || file.recid != "" || file.categoryNo != "" || file.tableName != "") {
                fileList.push(file);
            }
        });
        if (daglBorrowData.length > 0) {
            for (var i = 0; i < daglBorrowData.length; i++) {
                var count = 0;
                if (fileList.length > 0) {
                    for (var j = 0; j < fileList.length; j++) {
                        if (daglBorrowData[i].recid != fileList[j].recid) {
                            count++;
                        }
                        if (count == fileList.length) {
                            daglBorrowData[i].isBorrow="未借出";
                            fileList.push(daglBorrowData[i]);
                        }
                    }
                } else {
                    daglBorrowData[i].isBorrow="未借出";
                    fileList.push(daglBorrowData[i]);
                }
            }
            iniTable();
        }
        layer.msg("档案信息导入成功！", {icon: 1});
        sessionStorage.removeItem('daglSearchBorrowData');
    }

    function getDeptInfo(type) {
        //判断跟借阅人是否为同一人
        var borrowUserId = $("#borrowUserId").val();
        var approveUserId = $("#approveUserId").val();
        if("" != borrowUserId && approveUserId.indexOf(borrowUserId)>-1){
            layer.msg("审批人与借阅人不能为同一人，请重新选择！",{icon:0,time:2000});
            setTimeout(function(){
                //清空审批人的信息
                $("#approveUserId").val("");
                $("#approveUnitName").val("");
                $("#approveUnitId").val("");
                $("#approveUserName").val("").change();
            },1)


        }else{
            var userId = "";
            if('borrowUser' == type){
                userId = $("#borrowUserId").val();
            }else if('approveUser' == type){
                userId = $("#approveUserId").val();
            }
            $.ajax({
                type: "POST",
                url: "/dagl/daly/borrow/getDeptInfoByUserId",
                // contentType: "application/json",
                data: {userId: userId},
                dataType: "json",
                async: false,
                success: function (json) {
                    if (json.flag == '1') {
                        if('borrowUser' == type){
                            $("#borrowUnitId").val(json.borrowUnitId).change();
                            $("#borrowUnitName").val(json.borrowUnitName).change();
                            $("#borrowDeptId").val(json.borrowDeptId).change();
                            $("#borrowDeptName").val(json.borrowDeptName).change();
                        }else if('approveUser' == type){
                            $("#approveUnitId").val(json.borrowUnitId).change();
                            $("#approveUnitName").val(json.borrowUnitName).change();
                        }
                    } else {
                        layer.msg("失败！", {icon: 2});
                    }
                },
                error: function () {
                    layer.msg("失败！", {icon: 2});
                }
            });
        }
    }

</script>
</body>
</html>
