<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <meta http-equiv="Expires" content="0">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Cache-control" content="no-cache">
    <meta http-equiv="Cache" content="no-cache">
    
    <title></title>
    <link rel="stylesheet" type="text/css" href="/static/css/common/Loading.css">
    <link rel="stylesheet" href="/static/core/bootstrap/css/bootstrap.min.css"/>
    <link rel="stylesheet" href="/static/core/bootstrapvalidator/dist/css/bootstrapValidator.min.css"/>
    <link rel="stylesheet" href="/static/core/jquery-fileupload/css/jquery.fileupload.css">
     <link href="/static/core/bootstrap/css/bootstrap.css" rel="stylesheet" />
    <link href="/static/core/bootstrap-table/bootstrap-table.css" rel="stylesheet" />
    <link rel="stylesheet" type="text/css" href="/static/font/iconfont.css">
    <link rel="shortcut icon" href="/favicon.ico" />
    <link href="/static/core/bootstrap3-editable/css/bootstrap-editable.css" rel="stylesheet" />
    <link rel="stylesheet" href="/static/core/layer/theme/default/layer.css">
    <link rel="stylesheet" href="/static/css/gateway/reset.css">
    <link rel="stylesheet" href="/static/font/iconfont-gateway/iconfont.css">
    <!-- style.css -->
    <link href="/static/css/common/style.css" rel="stylesheet">
    <link href="/static/css/common/form-public.css" rel="stylesheet">
    <link href="/static/css/common/index.css" rel="stylesheet">

    <!-- 滚动条 -->
    <link rel="stylesheet" href="/static/core/mCustomScrollbar/jquery.mCustomScrollbar.css">

    <!-- 获取url -->
    <script src="/static/js/common/url.js" type="text/javascript"></script>

    <!-- 开关配置 -->
    <link rel="stylesheet" type="text/css" href="/modules/system/config/toggle/css/toggleStyle.css">
    <link href="/static/core/font-awesome-4.7.0/css/font-awesome.css" rel="stylesheet" type="text/css" />
    <link href="/static/core/font-awesome-4.7.0/css/font-awesome.min.css" rel="stylesheet" type="text/css" />
    <style type="text/css">
		span{ white-space:pre-wrap;word-wrap : break-word ;overflow: hidden ;text-align:left}
		/* #table_list tr {
	 		text-align:center
		} */
	</style>
</head>
<body class="formpage_bj">
<div class="container-fluid formpage_area">
    <form class="form-horizontal" id="form">
        <!-- 流程字段-->
		<input name="id" id="id" type="hidden" value=""/>
		<!-- 流程字段结束 -->
        <!-- 基本信息 -->
        <div class="row">
            <div class="col-md-12 ">
                <div class="block_title">
                    <span class="name">用户信息</span>
                </div>
            </div>
        </div>
        <div class="row m-t-15">
            <div class="col-md-12">
                <div class="form-group">
                    <label class="col-md-2 control-label"> 订单号：</label>
                    <div class="col-md-4 form-view">
                        <span id="orderNum" name="orderNum"></span>
                    </div>
                </div>
               <div class="form-group">
                    <label class="col-md-2 control-label">部门名称：</label>
                    <div class="col-md-4 form-view">
                    	<span id="deptName1" name="deptName1"></span>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-md-2 control-label">用户：</label>
                    <div class="col-md-2 form-view">
                    	<span id="creUserName" name="creUserName"></span>
                    </div>
                    <label class="col-md-2 control-label"> 门禁卡号：</label>
                   	<div class="col-md-2 form-view">
                        <span id="cardNo" name="cardNo"></span>
                    </div>
                    <label class="col-md-2 control-label"> 联系电话：</label>
                    <div class="col-md-2 form-view">
                        <span id="phone" name="phone"></span>
                     </div>
                </div>
                <div class="row">
					<div class="col-md-12 ">
						<div class="block_title">
							<span class="name">订单详情</span>
						</div>
					</div>
				</div>
            <div class="modal-body selectjs">
				<div class="selectjs_block" style="height: auto;">
					<div class="container-fluid">
						<div class="row">
							<!-- <div class="col-md-12">
								<div class="form-group">
				                    <label class="col-md-2 control-label" style="width: 13.3333%;"><b style="color:red">*</b> 联系方式：</label>
				                    <div class="col-md-3">
				                    	<input type="text" id="phone" name="phone" class="form-control" maxlength="11"/>
				                    </div>
			                    </div>
                			</div> -->
							<!--bootstrap-table表格-->
							<table id="right_table"></table>
						</div>
					</div>
				</div>
			</div>
		</div>
            </div>
        </div>
        <!-- 基本信息结束 -->
    </form>
</div>
<!-- 按钮区 -->
<!-- 按钮区结束 -->
<script src="/static/core/jquery/jquery-1.11.2.min.js"></script>
<script src="/static/core/bootstrap/js/bootstrap.min.js"></script>
<script src="/static/core/bootstrap-table/bootstrap-table.min.js"></script>
<script src="/static/core/bootstrap-table/locale/bootstrap-table-zh-CN.min.js"></script>
<script src="/static/core/bootstrapvalidator/dist/js/bootstrapValidator.min.js"></script>
<script src="/static/core/layer/layer.js"></script>
<script src="/static/js/common/mylayer.js"></script>
<script type="text/javascript" src="/static/js/common/assistUtil.js"></script>
<script src="/static/core/bootstrap/js/bootstrap.js"></script>
<script src="/static/core/bootstrap-table/extensions/editable/bootstrap-table-editable.js"></script>
<script src="/static/core/bootstrap3-editable/js/bootstrap-editable.js"></script>
<script src="/static/core/laydate/laydate.js"></script>
<!-- 流程相关 -->
<script type="text/javascript" src="/common/js/config.js"></script>
<script type="text/javascript" src="/common/js/commonFunction.js"></script>
<script type="text/javascript" src="/common/html/notion/notion.js"></script>
<!-- 获取cookie值 -->
<script type="text/javascript" src="/product/workflow/js/common/getCook.js"></script>
<!-- 页面获取参数 -->
<script type="text/javascript" src="/common/js/getrequest.js"></script>
<!-- 引入自己模块功能的js -->
<!-- 数据渲染 -->
<script src="/static/js/common/displayData.js"></script>
<script src="/static/core/jquery-fileupload/js/vendor/jquery.ui.widget.js"></script>
<script src="/static/core/jquery-fileupload/js/jquery.iframe-transport.js"></script>
<script src="/static/js/common/tablelist.js"></script>
<script type="text/javascript">
var right_table_col = [
{
    field: 'id'
    , title: '序号'
    , width: '5%'
    , sortable: false
    , order: "desc"
    , align:"center"
    , formatter: function (value, row, index) {
        //计算序号，并存放业务ID，及已办事项ID
        var pageSize=$('#right_table').bootstrapTable('getOptions').pageSize;//通过表的#id 可以得到每页多少条
        var pageNumber=$('#right_table').bootstrapTable('getOptions').pageNumber;//通过表的#id 可以得到当前第几页
        var orderNum = pageSize * (pageNumber - 1) + index + 1;//计算序号
        return "<span data-id='"+row.id+"'>"+orderNum+"</span>";    //返回每条的序号： 每页条数 * （当前页 - 1 ）+ 序号
    }
},{
    field: 'goodsName'
    , title: '商品名称'
    , width: '18%'
    , align:"center"
},{
     field: 'goodsPrice' 
    , title: '单价/元'
    , width: '16%'
    , align:"center"
},{
    field: 'goodsNum' 
   , title: '数量'
   , width: '16%'
   , align:"center"
	/* ,editable: {
    type: "text",                //编辑框的类型。支持text|textarea|select|date|checklist等
    mode: "popup",              //编辑框的模式：支持popup和inline两种模式，默认是popup
    //emptytext: "",
    title: '购买数量',
    validate: function (v) {
    	var reg=new RegExp("^[0-9]{0,4}$");
        if (!v) return '不能为空';
        if(v.length>4) return '不能超过4个字';
        if(!reg.test(v)) return '必须是数字';
    }
	} */
},{
    field: 'bugUnit' 
   , title: '购买单位'
   , width: '16%'
   , align:"center"
   ,visible:true
},{
    field: 'cz'
    , title: '操作'
    , width: '16%'
    , align: "center"
    , formatter: function (value, row, index) { 
        var html = "";
        html += "<i style='cursor:pointer;' class='glyphicon glyphicon-trash' title='删除' onclick=\'list.deleteFun(\""+ row.id + "\")\'></i>";
        return html;
    }
}];
$(document).ready(function (e) {
	var theRequest = GetRequest();
	$("#id").val(theRequest.id);
	if($("#id").val() != ""){
		//表单数据渲染
		var datas = {"id":$("#id").val()};
			httpRequest("get", "/mypage/wmgl/index/order/edit", datas, function(data) {
				$("#deptName1").text(data.data.fullDeptName);
				DisplayData.playData({data: data});
			});
			
	 	}
    //初始化表格
    TableInit.init({
        domId:"right_table",
        url:"/mypage/wmgl/index/OrderDetil/getlistBootHql",
        columns:right_table_col,
        queryParams:function(params){
        	params.orderId=$("#id").val();
            return params;
        },
        editable:true,
        rowStyle: function (row, index) {
            return {
                classes: 'readOnly'
                ,css: {"text-align":"center","cursor":"default"}
            };
        },
        onEditableSave: function (field, row, oldValue, $el) {
            //可进行异步操作
            $.ajax({
                type: "post",
                url: "/mypage/wmgl/index/OrderDetil/update?rdm="+Math.random(),
                data: row,
                dataType: 'JSON',
                success: function (json) {
                    if (json.flag == "1") {
                        layer.msg('提交数据成功！',{icon:1}); 
                    }
                },
                error: function () {
                    layer.msg('编辑失败！',{icon:0}); 
                },
                complete: function () {
                }
            });
        }
    });
});

//表格数据项的操作
var list = {
    deleteFun: function (id) {
    	var data = $("#right_table").bootstrapTable("getData");
    	if(data.length==1){
    		layer.msg("至少保留一件商品！",{icon:0})
    	}else{
	    	MyLayer.deleteOpt({
	            url: '/mypage/wmgl/index/OrderDetil/delete?id=' + id,
	            tableId: 'right_table'
	        })
    	}
    }
}

</script>
</body>
</html>
