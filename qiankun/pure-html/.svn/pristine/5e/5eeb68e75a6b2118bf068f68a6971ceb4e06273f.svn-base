<!DOCTYPE html>
<html lang="zh_CN">
<head>
    <meta charset="UTF-8">

    <meta http-equiv="Expires" content="0">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Cache-control" content="no-cache">
    <meta http-equiv="Cache" content="no-cache">

    <title>意见信息</title>
    <link rel="stylesheet" href="/static/core/bootstrap/css/bootstrap.min.css"/>
    <link rel="stylesheet" href="/static/core/bootstrap-table/bootstrap-table.css"/>
</head>
<body style="margin: 20px;">
    <table id="table"></table>

    <script src="/static/core/jquery/jquery-1.11.2.min.js"></script>
    <script src="/static/core/bootstrap/js/bootstrap.min.js"></script>
    <script src="/static/core/bootstrap-table/bootstrap-table.min.js"></script>
    <script src="/static/core/bootstrap-table/locale/bootstrap-table-zh-CN.min.js"></script>
    <script src="/product/workflow/js/common/getrequest.js"></script>
	<script src="/product/workflow/js/common/getCook.js"></script>

    <script type="text/javascript">
    var getShowIdeaURL="/workflow/getformalidea";	//获取正式意见
    var getBackIdeaURL="/workflow/getBackIdea";		//获取退回意见
    var request = GetRequest();
    var recordid=request.recordid;
    var filetypeid=!request.workflowid?request.filetypeid:request.workflowid;
    var deptid=getcookie("deptid");
    var userid=getcookie("userid");
    
    $('#table').bootstrapTable({
            url:getShowIdeaURL+"?pkValue="+recordid+"&filetypeid="+filetypeid+"&deptid="+deptid+"&userid="+userid,
            striped: true,//隔行变色
            responseHandler:function (res) {
            	return respHandler(res);
            },
            columns: [{
                //field: 'id',
                title: '序号',
                align: "center",
                width: '5%',
                formatter: function (value, row, index) {
                	//计算序号，并存放业务ID，及已办事项ID
                	var pageSize=$('#table').bootstrapTable('getOptions').pageSize;//通过表的#id 可以得到每页多少条
                    var pageNumber=$('#table').bootstrapTable('getOptions').pageNumber;//通过表的#id 可以得到当前第几页
                    return pageSize * (pageNumber - 1) + index + 1;//计算序号
                }
            }, {
                field: 'note',
                title: '意见类型',
                align: "center",
                width: '10%'
            }, {
                field: 'idea',
                title: '意见内容',
                align: "center",
                width: '20%'
            }, {
                field: 'userName',
                title: '姓名',
                align: "center",
                width: '10%'
            }, {
                field: 'deptName',
                title: '部门',
                align: "center",
                width: '20%'
            }, {
                field: 'ideaTime',
                title: '填写时间',
                align: "center",
                width: '15%'
            }]
        });
    
    	//获取退回意见
	    $.ajax({
	        url : getBackIdeaURL+"?pkValue="+recordid+"&filetypeid="+filetypeid+"&deptid="+deptid+"&userid="+userid,
	        type : "GET",
	        //data : data,
	        dataType : "json",
	        success : function(res) {
	            $('#table').bootstrapTable('append', respHandler(res));
	        },
	        error : function(error) {
	        	//showDialogAlert("获取失败，请刷新重试或联系管理员");
	        }
	    });
    	
    	//返回值处理方法
    	function respHandler(res){
    		var ideaList = [];
        	if(!$.isEmptyObject(res)){
        		for(var i =0 ;i < res.length;i++){
        			if(res[i].ideaList.length > 0){
        				for(var j=0;j<res[i].ideaList.length;j++){
        					ideaList.push({
        						"note":res[i].note,
        						"idea":res[i].ideaList[j].idea,
        						"userName":res[i].ideaList[j].username,
        						"deptName":res[i].ideaList[j].deptname,
        						"ideaTime":res[i].ideaList[j].ideatime
        					});
        				}
        			}
        		}
            }
            return ideaList;
    	}

    </script>
</body>
</html>