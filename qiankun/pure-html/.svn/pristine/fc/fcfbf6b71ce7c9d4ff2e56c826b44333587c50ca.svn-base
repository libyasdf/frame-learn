<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
    <title>基础配置</title>
    <!--弹出部门或人员-->
    <script type="text/javascript" src="/modules/system/component/tree/js/deptUserTree.js"></script>
    <script type="text/javascript" src="/modules/system/component/groupTree/js/groupUserTree.js"></script>
    <!--树状图-->
    <link rel="stylesheet" href="/static/core/zTree_v3/css/zTreeStyle/zTreeStyle.css" type="text/css">
    <script src="/static/core/zTree_v3/js/jquery.ztree.all.min.js"></script>
    <!--下拉多选-->
    <link rel="stylesheet" type="text/css" href="/static/core/bootstrap/css/bootstrap.min.css">
    <link href="/manage/bootstrap/css/bootstrap-select.min.css" rel="stylesheet" />
    <script type="text/javascript" src="/manage/bootstrap/js/bootstrap-select.js"></script>
    <script type="text/javascript" src="/manage/bootstrap/js/bootstrap-select-create.js"></script>
	<!--让IE8/9支持媒体查询，兼容栅格布局-->
	<script src="/static/core/html5/html5shiv.min.js"></script>
	<script src="/static/core/html5/respond.js"></script>
    <!--全局工具js-->
    <script src="/manage/hp/js/help.js"></script>


	<style>
        #basicCon_table th{
            text-align: center;
        }
	</style>

  </head>
<body>
    <!--查询-->
    <div class="col-md-12">
        <div class="panel panel-default toggle" style="margin-bottom: 0px;">
            <div class="panel-heading" style="cursor: pointer;">
                <h3 class="panel-title" style="display: inline-block;">查询项</h3>
                <div class="panel-controls"style="float: right;" >
                    <i class="glyphicon glyphicon-plus showSelect"></i>
                </div>
            </div>
            <div class="panel-body" style="display: none;"><!--需隐藏展示的内容写此-->
                <div id="basicCon_head" class="col-md-12 col-xs-12">
                    <!--查询结束-->
                    <div class="page-header" style="margin-top: 0px;">
                        <h4>查询条件</h4>
                    </div>
                    <div class="col-md-12 col-xs-12 media-heading">
                        <label class="col-md-2 text-right">角色名称:</label>
                        <div class="col-md-4">
                            <input id="basicCon_businessRoleName" type="text"class="form-control" style="width: 220px;">
                        </div>
                        <label class="col-md-2 text-right">级别:</label>
                        <div class="col-md-4">
                            <select id="basicCon_grade" class="selectpicker">
                            </select>
                        </div>
                    </div>
                    <div class="col-md-12 col-xs-12 media-heading">
                        <label class="col-md-2 text-right">职能处:</label>
                        <div class="col-md-4">
                            <input id="basicCon_chushiId" type="hidden">
                            <input id="basicCon_chushiName" type="text"class="form-control" style="width: 220px;"
                                   onclick="openSelectZtree({'id':'basicCon_chushiId','name':'basicCon_chushiName','isMulti':1,'type':'2','asyn':false,'level':2,'url':'/system/component/tree/deptTree'})">
                        </div>
                        <label class="col-md-2 text-right">职能:</label>
                        <div class="col-md-4">
                            <input id="basicCon_functional" type="text"class="form-control" style="width: 220px;">
                        </div>
                    </div>
                    <div class="col-md-12 col-xs-12 media-heading">
                        <label class="col-md-2 text-right">适用范围:</label>
                        <div class="col-md-4">
                            <select id="basicCon_adaptiveNorm" class="selectpicker" style="width: 100%">
                            </select>
                        </div>
                        <label class="col-md-2 text-right">分类:</label>
                        <div class="col-md-4">
                            <select id="basicCon_classify" class="selectpicker">
                            </select>
                        </div>
                    </div>
                    <div class="col-md-12 col-xs-12 media-heading" style="margin-top: 10px;">
                        <div class="col-md-5">
                            <button id="basicCon_select" class="btn btn-default pull-right basicConEvent" style="width: 6em;">查询</button>
                        </div>
                        <div class="col-md-5 col-md-offset-1">
                            <button id="basicCon_reset" class="btn btn-default basicConEvent" style="width: 6em;">重置</button>
                        </div>
                    </div>



                </div>
            </div>
        </div>
    </div>

    <div id="basicCon_body" class="col-md-12 col-xs-12">
        <div class="page-header" style="margin-top: 25px;">
            <h4>权限信息</h4>
        </div>
        <div class="col-md-12 col-xs-12">
            <button id="basicCon_batchConfig" class="btn btn-default basicConEvent" style="width: 6em;">批量配置</button>
        </div>
        <div class="col-md-12 col-xs-12">
            <table id="basicCon_table" class="table table-condensed table-hover table-bordered text-center navbar-btn">
                <thead>
                    <tr style="background: #d2d2d2;">
                        <th><input type="checkbox" name="all"  value=""></th>
                        <th>业务角色</th>
                        <th>级别</th>
                        <th>职能处</th>
                        <th>职能</th>
                        <th>适用范围</th>
                        <th>分类</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><input type="checkbox" name="业务角色ID1"  value=""></td>
                        <td>角色1</td>
                        <td>局级</td>
                        <td>处室1</td>
                        <td>职能1</td>
                        <td>指定处室</td>
                        <td>基础</td>
                    </tr>
                    <tr>
                        <td><input type="checkbox" name="业务角色ID2"  value=""></td>
                        <td>角色1</td>
                        <td>处级</td>
                        <td>处室2</td>
                        <td>职能1</td>
                        <td>综合部门</td>
                        <td>职能部门审配</td>
                    </tr>
                </tbody>
            </table>

        </div>

    </div>


</body>


<script src="/common\js\getrequest.js"></script>
<script>
    var url = GetMenuUrl();
    var resId = GetMenuResId();
    //debugger;
    TableInit.init({});
    (function(){
        //解绑事件
        $(".basicConEvent").off();
        $(document).off(".basicCon");
        //<!--查询框初始化-->
        $('.panel-heading').unbind('click').bind('click',function(){
            if($(this).find('.showSelect').hasClass('glyphicon-minus')){
                $('.panel-body').hide();
                $(this).find('.showSelect').removeClass('glyphicon-minus').addClass('glyphicon-plus');
            }else{
                $('.panel-body').show();
                $(this).find('.showSelect').removeClass('glyphicon-plus').addClass(' glyphicon-minus');
            }
        })
        //初始化操作
        function initQuery(){
            //字典初始化
            $('#basicCon_grade').bootstrapSelect({
                data: [{"text":"局级","value":"401"},{"text":"二级局","value":"402"},{"text":"处级","value":"93248"},{"text":"科级","value":"93248"}],
                valueField: 'value',//根据返回值去写此进行绑定值
                textField: 'text',
                onLoadSuccess:function () {
                    //console.log(("成功返回"));
                    bootstrapSelect.init("#basicCon_grade");
                }
            });
            //适用范围字典
            bootstrapSelect.dictionaries({selectID:'basicCon_adaptiveNorm',mark:"dwgl_orgType",type:"1",bolRecord:true});
            //分类字典
            bootstrapSelect.dictionaries({selectID:'basicCon_classify',mark:"dwgl_orgType",type:"1",bolRecord:true});
            $('#basicCon_grade,#basicCon_adaptiveNorm,#basicCon_classify').selectpicker('val', '');

            query();//查询数据

        }
        initQuery();
        //查询点击
        $("#basicCon_select").on("click",function() {
            //console.log("查询点击");
            query();
        });
        //重置点击
        $("#basicCon_reset").on("click",function() {
            //console.log("重置点击");
            $('#basicCon_grade,#basicCon_adaptiveNorm,#basicCon_classify').selectpicker('val', '');
            $("#basicCon_businessRoleName,#basicCon_chushiId,#basicCon_chushiName,#basicCon_functional").val('');

        });
        //批量配置点击
        $("#basicCon_batchConfig").on("click",function() {
            console.log("批量配置点击");
            var checkedL=$("#basicCon_table tbody [type='checkbox']:checked").length;
            if(checkedL==0){
                layer.msg("无选中数据!", {icon: 0});//感叹号
                return false;
            }
            layer.open({
                type: 1	//非iframe;2是iframe,content要为地址
                ,title: false //不显示标题栏
                ,closeBtn: false	//右上角是否需要叉
                ,area: '800px;'//设宽;高度-auto
                ,shade: 0.8
                ,id: 'LAY_layuipro' //设定一个id，防止重复弹出
                ,btn: ['保存', '关闭']
                ,yes: function(index, layero){//按钮一的回调
                    console.log("保存进入");

                    basicCon_adaptiveNorm="";
                    if(basicCon_adaptiveNorm==1){//如果是指定范围
                        if(true){
                            layer.msg("请指定处室", { icon: 0 });
                            return false;
                        }
                    }
                    $.ajax({//保存功能
                        'url' : '/testPageController/returnEmpty',
                        'type':'POST',
                        'dataType':'json',
                        'data' : {
                            //条件
                        }
                    }).done(function( data, textStatus, jqXHR ) {

                        console.log("成功返回");
                        if (data.flag == '1') {

                        }else{
                            //layer.msg(data.msg, { icon: 2 });
                        }

                    }).fail(function( jqXHR, textStatus, errorThrown ) {
                        console.log("错误异常:"+errorThrown);
                    })


                    layer.close(index);//关闭当前窗口
                }
                ,btnAlign: 'c'	//	按钮居中对齐
                ,moveType: 1 //拖拽模式，0或者1(我是没看出区别)
                ,content: '  <div class="page-header" style=\"margin-left: 15px;\">\n' +
                    '            <h4>配置信息</h4>\n' +
                    '        </div>\n' +
                    '        <div class="col-md-12 col-xs-12 media-heading">\n' +
                    '            <label class="col-md-2 text-right">职能处:</label>\n' +
                    '            <div class="col-md-4">\n' +
                    '                <input id="basicCon_chushiId_S" type="hidden">\n' +
                    '                <input id="basicCon_chushiName_S" type="text"class="form-control" style="width: 220px;"\n' +
                    '                       onclick="openSelectZtree({\'id\':\'basicCon_chushiId\',\'name\':\'basicCon_chushiName\',\'isMulti\':1,\'type\':\'2\',\'asyn\':false,\'level\':2,\'url\':\'/system/component/tree/deptTree\'})">\n' +
                    '            </div>\n' +
                    '            <label class="col-md-2 text-right">职能:</label>\n' +
                    '            <div class="col-md-4">\n' +
                    '                <input id="basicCon_functional_S" type="text"class="form-control" style="width: 220px;">\n' +
                    '            </div>\n' +
                    '        </div>\n' +
                    '        <div class="col-md-12 col-xs-12 media-heading">\n' +
                    '            <label class="col-md-2 text-right">适用范围:</label>\n' +
                    '            <div class="col-md-4">\n' +
                    '                <select id="basicCon_adaptiveNorm_S" class="selectpicker" style="width: 100%">\n' +
                    '                </select>\n' +
                    '            </div>\n' +
                    '            <label class="col-md-2 text-right">分类:</label>\n' +
                    '            <div class="col-md-4">\n' +
                    '                <select id="basicCon_classify_S" class="selectpicker">\n' +
                    '                </select>\n' +
                    '            </div>\n' +
                    '        </div>\n' +
                    '        <div class="col-md-12 col-xs-12 media-heading">\n' +
                    '            <label class="col-md-2 text-right">指定处室:</label>\n' +
                    '            <div class="col-md-10">\n' +
                    '                <input type="hidden" id="basicCon_chuId_ds_hidden">\n' +
                    '                <textarea id="basicCon_chuId_ds" style="width: 100%;"onclick="openSelectZtree({\'id\':\'basicCon_chuId_ds_hidden\',\'name\':\'basicCon_chuId_ds\',\'type\':\'2\',\'asyn\':false,\'level\':2,\'url\':\'/system/component/tree/deptTree\'})"></textarea>\n' +
                    '            </div>\n' +
                    '        </div>'
                ,success: function(layero){//加载完成后执行的js
                    //适用范围字典
                    bootstrapSelect.dictionaries({selectID:'basicCon_adaptiveNorm_S',mark:"dwgl_orgType",type:"1",bolRecord:true});
                    //分类字典
                    bootstrapSelect.dictionaries({selectID:'basicCon_classify_S',mark:"dwgl_orgType",type:"1",bolRecord:true});
                    $('#basicCon_adaptiveNorm_S').selectpicker('val', '');
                    $('#basicCon_classify_S').selectpicker('val', '');
                    $("#basicCon_adaptiveNorm_S")

                }
            });
            //$("#basicCon_table tbody:checked").each(function(index,element){});
        });
        //全选,反选 多选按钮点击
        $("#basicCon_table thead [name='all']").on("click",function() {
            console.log("全选,反选 多选按钮点击");
            var bol=$(this).prop("checked");
            $("#basicCon_table tbody [type='checkbox']").prop("checked", bol);
        });
        //查询点击
        function query() {
            var basicCon_businessRoleName=$.trim($("#basicCon_businessRoleName").val());
            var basicCon_chushiId=$.trim($("#basicCon_chushiId").val());//处室ID
            var basicCon_chushiName=$.trim($("#basicCon_chushiName").val());//处室名称
            var basicCon_functional=$.trim($("#basicCon_functional").val());//职能
            var basicCon_grade=$.trim($("#basicCon_grade").val());//级别
            var basicCon_adaptiveNorm=$.trim($("#basicCon_adaptiveNorm").val());//适用范围
            var basicCon_classify=$.trim($("#basicCon_classify").val());//分类
            $.ajax({
                'url' : '/testPageController/returnEmpty',
                'type':'POST',
                'dataType':'json',
                'data' : {
                    //条件
                }
            }).done(function( data, textStatus, jqXHR ) {
                console.log("成功返回");
                /*if (data.flag == '1') {

                }else{
                    layer.msg(data.msg, { icon: 2 });//小红叉
                }*/
                data=[{}];
                var strHTML="";
                for (var i = 0; i < data.length; i++){
                    var  dataMap=data[i];

                }


            }).fail(function( jqXHR, textStatus, errorThrown ) {
                console.log("错误异常:"+errorThrown);
            })
        }

        //如果适用范围是指定处室,才需要展示指定处室
        $(document).on('change.basicCon', '#basicCon_adaptiveNorm_S', function() {
           var adaptiveNorm_S=$(this).val();
           if(adaptiveNorm_S==1){
               $("#basicCon_chuId_ds").parent().parent().show();
           }else {
               $("#basicCon_chuId_ds").parent().parent().hide();
           }

        });


    })();
</script>

</html>