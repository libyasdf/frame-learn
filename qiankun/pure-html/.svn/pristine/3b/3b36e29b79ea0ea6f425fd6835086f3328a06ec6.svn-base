<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>选择办理人</title>
<link href="../plugins/bootstrap/bootstrap.css" rel="stylesheet">
<link href="../css/formAndWorkflow.css" rel="stylesheet">
<style>
	html,body{
		height:100%;
	}
</style>

<script src="../plugins/jquery/jquery-1.11.2.min.js"></script>
<script src="../js/common/getrequest.js"></script>
<script type="text/javascript">
	var workitemid = "";
	var wfleveId = "";
	$(document).ready(function () { 
		var api = frameElement.api, W = api.opener;
		workitemid = api.data.workitemid;
		wfleveId = api.data.wfleveId;
		init(wfleveId);
	});
	function init(wfleveId){
		var view = "<tr style='height:45px;'><td style='width:30%'><div class='title03'><img src='../image/do.png'>待选参与者</div></td>"
			 	 + "<td><div class='title03'><img src='../image/done2.png'>已选参与者</div></td></tr>"	
				 + "<tr>"
				 + "<td style='border-right:1px solid #ddd'><div id='tdWrap' style='height:405px;overflow-y:scroll'>"
			 	 + "<div style='padding: 5px;'>"
				 + "<ul id='tree_0' class='ztree' style='-moz-user-select: none;width:100%;padding:1%;'>";
		$.ajax({
			 type: "POST",
			 url: basePath+"/workflow/getJumpWfAppointWrite",
			 data: {
				 wfleveId:wfleveId
			 },
			 success: function(data){
				 for ( var i in data) {
					 view += "<span id='tree_0_2_span' class='node_name' style='display: inline-block;margin: 0;padding: 0;background: #F1F1F2;width: 100%; padding: 8px;padding-left:7%;'>"+data[i].deptName+"</span><br>";
					 var arr = data[i].res;
					 for ( var j in arr) {
						view += "<a href='javascript:void(0)' style='    display: inline-block; border-bottom: 1px dashed #dcdcdc; width: 100%;padding: 7px 0;padding-left:7%;color:#666;'><input name='box' type='checkbox' onchange='chooserUser(this)' style='margin-right:5px;'>"
							  + "<span class='button ico_docu' title='' treenode_ico='' style='' show-type='"+arr[j].userNm+"/"+arr[j].deptname+"' deptid='"+arr[j].deptId+"' value='"+arr[j].userid+"'>"+arr[j].userNm+"</span></a><br>";
					 }
				 }
				 view += "</ul></div></td>"
				 	   + "</div><td><div class='form-group clearfix' style='width:80%;margin: 0 auto;'><ul id='userArea'  class='form-control' style='overflow: auto;height: 250px;list-style:none;'></ul></div></td>"
				 	   + "</tr>";
				 $("#deptArea").html(view);
			 }
		});
	}
	function chooserUser(obj){
		var id = $($(obj).next()).attr("value");
		if($(obj).is(':checked')){
			var view = $("#userArea").html();
			view += "<li id = '"+id+"' deptid = '"+$($(obj).next()).attr("deptid")+"'>"+$($(obj).next()).attr("show-type")+"</li>";
			$("#userArea").html(view);
		}else{
			del(id);
		}
	}
	
	function del(userid) {
		var arr = document.getElementById('userArea');
		var t = arr.childNodes;
		for (var i = 0; i < t.length; i++) {
			if (userid == $(t[i]).attr("id")) {
				arr.removeChild(arr.childNodes[i]);
			}
		}
	}
	
	function jumpNode(){
		var array = "";
		var arr = document.getElementById('userArea');
		var t = arr.childNodes;
		for (var i = 0; i < t.length; i++) {
			if(i!=t.length-1){
				array += $(t[i]).attr("deptid") + "*" + $(t[i]).attr("id") + ",";
			}else{
				array += $(t[i]).attr("deptid") + "*" + $(t[i]).attr("id");
			}
		}
		var mdata = {
			 wfleveid:wfleveId,
			 workitemid:workitemid,
			 rolesId:array
		}
		getDataByAjax(basePath+"/flowService/jumpToWfleve",mdata,function(data){
			if(data.res){
				alert("跳转成功！");
				window.close();
			}else{
				alert("跳转失败！");
			}
		});
	}
	
	
	function getDataByAjax(url,data,callback){
		var options = {
			async : false,  
	        cache:false,  
			type: "post",  
			url : url,
			data:data,   
			dataType : 'json'
		};
		var returnVal = {};
		$.when(
			$.ajax(options)
		).then(function(data){
			returnVal = data;
			if(callback){
				callback(data);
			}
		},function(data){
			returnVal = data;
		});
		
		return returnVal;
	}	
</script>
</head>
<body>
	<div class=" modal-pt width820 " style="height:100%;">
	<div class=""  style="height:100%;">
		<div class="modal-content style1" style="height:100%;">
			<div class="modal-body" style="height:100%;">
               <table width="100%" border="0" style="height:100%;">
				  <tbody id="deptArea" style="">
				     
				  </tbody>
			   </table>
            </div>
		</div><!-- /.modal-content -->
	</div><!-- /.modal-dialog -->
</div>
</body>
</html>