<!DOCTYPE html>
<html lang="zh-CN">
<head>
	<meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <meta http-equiv="Expires" content="0">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Cache-control" content="no-cache">
    <meta http-equiv="Cache" content="no-cache">
    
    <title></title>
    <link rel="stylesheet" href="/static/core/bootstrap/css/bootstrap.min.css"/>
    <link rel="stylesheet" href="/static/core/bootstrapvalidator/dist/css/bootstrapValidator.min.css"/>
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="/static/core/html5/html5shiv.min.js"></script>
    <script src="/static/core/html5/respond.js"></script>
    <![endif]-->
    <link href="/static/css/common/style.css" rel="stylesheet"/>
    <link href="/static/css/common/form-public.css" rel="stylesheet"/>
    <!-- CSS to style the file input field as button and adjust the Bootstrap progress bars -->
    <link rel="stylesheet" href="/static/core/jquery-fileupload/css/jquery.fileupload.css">
    <link rel="stylesheet" href="/static/font/iconfont.css">
</head>

<body class="formpage_bj">
	<div class="container-fluid formpage_area">
		<form id="form" class="form-horizontal">
			<!-- resId -->
			<input type="text" id="resId" name="resId" value="" hidden="true">
			<!-- 开关字段 -->
			<input type="text" id="type" name="type" value="" hidden="true">
			<input type="text" id="id" name="id" value="" hidden="true">
			<input type="text" id="state" name="state" value="" hidden="true">
			<input type="text" id="creUserId" name="creUserId" value="" hidden="true">
			<input type="text" id="creTime" name="creTime" value="" hidden="true">
			<input type="text" id="updateUserId" name="updateUserId" value="" hidden="true">
			<input type="text" id="updateTime" name="updateTime" value="" hidden="true">
			<!-- 流程字段结束 -->
	        <input type="hidden" id="textId"/>
	        <!-- 基本信息 -->
	        <div class="row">
	            <div class="col-md-12 ">
	                <div class="block_title">
	                    <span class="name" >开关基本信息</span>
	                </div>
	            </div>
	        </div>
			<!--查询项输入框选择框等开始-->
			<div class="row m-t-15">
	            <div class="col-md-12">
					<div class="form-group">
						<label class="col-sm-offset-1 col-sm-2 control-label">
							<b style="color: red;">*</b> 开关名称：</label>
						<div class="col-sm-7">
							<input class="form-control" type="text" id="name" name="name" >
						</div>
					</div>
		
					<div class="form-group">
						<label class="col-sm-offset-1 col-sm-2 control-label">
							<b style="color: red;">*</b> 开关标识：</label>
						<div class="col-sm-7">
							<input class="form-control" type="text" name="key" id="key" readonly>
						</div>
					</div>
		
					<div class="form-group">
						<label class="col-sm-offset-1 col-sm-2 control-label"> 开关状态：</label>
						<div class="col-sm-7">
							<label class="radio-inline"> 
								<input type="radio" name="isOpen" value="1" checked>
								 开
							</label>
							<label class="radio-inline"> 
								<input type="radio" name="isOpen" value="0">
								关
							</label>
						</div>
					</div>
					<div class="form-group">
						<label class="col-sm-offset-1 col-sm-2 control-label"> 开关描述：</label>
						<div class="col-sm-7">
							<textarea class="form-control" rows="3" name="describe" id="describe"></textarea>
						</div>
					</div>
					<!--查询项输入框选择框等结束-->
		
					<!--查询重置等按钮-->
					<div class="form-group">
						<div class="col-sm-12" style="text-align: center">
							<button type="button" class="btn btn-primary" onclick="saveToggle()">
								保&nbsp;&nbsp;存
							</button>
							&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
							<button type="button" class="btn btn-primary" onclick="closeIfram();">
								关&nbsp;&nbsp;闭
							</button>
						</div>
					</div>
				</div>
			</div>
			<!--查询重置等按钮 end-->
		</form>
	</div>
	<!-- 按钮区结束 -->
<script src="/static/core/jquery/jquery-1.11.2.min.js"></script>
<script src="/static/core/bootstrap/js/bootstrap.min.js"></script>
<script src="/static/core/bootstrap-table/bootstrap-table.min.js"></script>
<script src="/static/core/bootstrap-table/locale/bootstrap-table-zh-CN.min.js"></script>
<script src="/static/core/bootstrapvalidator/dist/js/bootstrapValidator.min.js"></script>
<script src="/static/core/layer/layer.js"></script>
<script src="/static/js/common/mylayer.js"></script>
<script type="text/javascript" src="/static/js/common/assistUtil.js"></script>

<script src="/static/core/laydate/laydate.js"></script>
<!-- 流程相关 -->
<script type="text/javascript" src="/common/js/config.js"></script>
<script type="text/javascript" src="/product/workflow/js/storages.js"></script>
<script type="text/javascript" src="/common/js/commonFunction.js"></script>
<!-- <script type="text/javascript" src="/common/js/overlay.js"></script> -->
<!-- 获取cookie值 -->
<script type="text/javascript" src="/product/workflow/js/common/getCook.js"></script>
<!-- 页面获取参数 -->
<script type="text/javascript" src="/common/js/getrequest.js"></script>
<!-- 自定义意见(最后进行加载) -->
<script type="text/javascript" src="/common/html/notion/notion.js"></script>
<!-- 数据回显 -->
<script type="text/javascript" src="/static/js/common/displayData.js"></script>

<!--文件上传js-->
<!-- The jQuery UI widget factory, can be omitted if jQuery UI is already included -->
<script src="/static/core/jquery-fileupload/js/vendor/jquery.ui.widget.js"></script>
<!-- The Iframe Transport is required for browsers without support for XHR file uploads -->
<script src="/static/core/jquery-fileupload/js/jquery.iframe-transport.js"></script>
<!-- The basic File Upload plugin -->
<script src="/static/core/jquery-fileupload/js/jquery.fileupload.js"></script>
<script src="/static/js/common/myfilupload.js"></script>
<script type="text/javascript" src="js/toggleValidator.js"></script>
<script type="text/javascript">
	$(function () {
	    // 初始化参数
        var theRequest = GetRequest();
        $("#resId").val(theRequest.resId ? theRequest.resId : "");
        $("#id").val(theRequest.id ? theRequest.id : "");
        $("#state").val(theRequest.state ? theRequest.state : "");
        $("#creUserId").val(theRequest.creUserId ? theRequest.creUserId : "");
        $("#creTime").val(theRequest.creTime ? theRequest.creTime : "");
        $("#updateUserId").val(theRequest.updateUserId ? theRequest.updateUserId : "");
        $("#updateTime").val(theRequest.updateTime ? theRequest.updateTime : "");
        $("#type").val(theRequest.type ? theRequest.type : "");
        $("#key").val(theRequest.key ? theRequest.key : "");
        if ($("#type").val() == "0" && $("#id").val() == "") {//type=0新增,新增的时候唯一标识可编辑。
            $("#key").removeProp("readonly");
		}
        $("#describe").text(theRequest.describe ? theRequest.describe : "");

		if($("#id").val() != ""){
            var datas = {"id":$("#id").val(),"resId":$("#resId").val()};
            httpRequest("get","/system/config/toggle/view",datas,function (data){
        	$("input[name=isOpen][value=" + (data.data.isOpen ? data.data.isOpen : "0") + "]").attr("checked", true);
                DisplayData.playData({data: data});
            });
		}
    })


	// 提交
	function saveToggle() {
		var bootstrapValidator = $("#form").data('bootstrapValidator');
	    //手动触发验证
	    bootstrapValidator.validate();
	    if(bootstrapValidator.isValid()){
			$.ajax({
	    		type: "POST",
	    		url:"/system/config/toggle/saveorupdate",
	    		data:$("#form").serialize(),
	    		async: false,
	    		dataType:"json",
	    		success:function(data){
	    		    if ('1' == data.flag) {
                        layer.msg("保存成功！", {icon: 1,time:1000}, function (index) {
                            if (data.data.type == '0') {
								if($("#id").val() != ""){
								    parent.typeTree.updateNode(data);
                                }else{
                                    parent.typeTree.addNode({id:data.data.id,name:data.data.name,key:data.data.key,isOpen:data.data.isOpen,describe:data.data.describe});// 在ztree中增加新保存的节点
								}
							} else if (data.data.type == '1') {
                                window.parent.refresh();
                                // $("#right_table", parent.document).bootstrapTable("refresh");
							}
							//关闭当前窗口
                            closeIfram();
                            window.parent.refresh();
                            // $("#right_table", parent.document).bootstrapTable("refresh");
                        });
                    }
	    		},
	    		error:function(data){
	    			
	    		}
	    	});
	    }
        //@ sourceURL=editForm.html
	}

	//关闭当前窗口
	function closeIfram(){
        var index=parent.layer.getFrameIndex(window.name);
        parent.layer.close(index);
	}
</script>
</body>
</html>